/**
 * \file        tutorials_1d.doc
 * \author      Cyrille Bonamy and Julien Chauchat
 * \date        June 03, 2021
 * \brief       Tutorials 1D (doc)
 */
/*! \page tutorials_1d One-dimensional test cases

In this chapter we shall describe in detail the process of setup, simulation and post-processing for some SedFoam test cases
All the tutorial cases are in the tutorial directory. The text herein is highly inspired from the OpenFOAM user-guide for the cavity tutorial available at http://cfd.direct/openfoam/user-guide/cavity/ but is adapted to the specificity of SedFoam.

The test cases provided with SedFoam are aimed to facilitate the learning as well as to allow for the development of new configurations. If you develop new things do not hesitate to share your development with us so that we can incorporate them in the github repository and others will benefit from your work the way you benefited from the original SedFoam version!

\tableofcontents{xml:1}

A number of one-dimensional test cases are provided with reference solutions, analytical, experimental or numerical, to validate SedFoam implementation and developments. Most of these test cases are used in the contiunous integration procedure to verify every new developments in SedFoam.

\section  Sedim_testcase 1DSedim: Pure sedimentation

This tutorial will describe how to pre-process, run and post-process a case corresponding to a pure sedimentation problem in a one-dimensional configuration using the two-phase flow equations. The geometry is shown in Figure 1 in which bottom boundary is a wall and the top boundary is an open boundary.  Initially, the flow is at rest and will be solved on a uniform mesh using the SedFoam solver for laminar, isothermal, incompressible two-phase flow. The numerical results are compared with experiments to validate the model in terms of settling curves, time evolution of concentration interface, and concentration profiles.


\subsection preproc Pre-processing

Like in OpenFOAM, cases are setup by editing case files using a text editor such as atome, vscode/vscodium, emacs, vi, gedit, nedit, etc. The I/O uses a dictionary format with keywords. A case involves data for mesh, fields, properties, control parameters, etc  that are stored in a set of files within a case directory rather than in a single case file. The case directory is given a suitably descriptive name. This tutorial consists of a set of cases located in the SedFoam distribution under the folder *sedFoamDirectory/tutorials/1DSedim*.

\paragraph meshgen Mesh generation

OpenFOAM always operates in a 3 dimensional Cartesian coordinate system and all geometries are generated in 3 dimensions. OpenFOAM solves the case in 3 dimensions by default but can be instructed to solve in 2 dimensions by specifying a ‘special’ empty boundary condition on boundaries normal to the (3rd) dimension for which no solution is required. In 2 dimensions, the directions x and y are always chosen even if the mesh is given in the x-z plane.

The sedimentation domain consists of a square of side length L = 0.006 m in the x–y plane and of height h=0.06 m in the vertical direction z. The side length is chosen to ensure a unity cell aspect ratio. A uniform mesh of 1 by 1 by 100 cells will be used. The block structure is shown in Figure 1.

@image html "Skecth1DSedim.png" "Figure 1: Block structure of the mesh for the 1D sedimentation problem. " width=200px
@image latex "Skecth1DSedim.png" "Figure 1: Block structure of the mesh for the 1D sedimentation problem. " width=200px



The mesh generator supplied with OpenFOAM, blockMesh, generates meshes from a description specified in an input dictionary, blockMeshDict located in the constant/polyMesh directory for a given case. The blockMeshDict entries for this case are as follows:

\verbatim

/*--------------------------------*- C++ -*----------------------------------*\
| =========                 |                                                 |
| \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox           |
|  \\    /   O peration     | Version:  1.7.1                                 |
|   \\  /    A nd           | Web:      www.OpenFOAM.com                      |
|    \\/     M anipulation  |                                                 |
\*---------------------------------------------------------------------------*/
FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      blockMeshDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

convertToMeters 0.06;

vertices
(
    (-0.005 0   0.005) //0
    ( 0.005 0   0.005) //1
    ( 0.005 1.  0.005) //2
    (-0.005 1.  0.005) //3
    (-0.005 0  -0.005) //4
    ( 0.005 0  -0.005) //5
    ( 0.005 1. -0.005) //6
    (-0.005 1. -0.005) //7
);

blocks
(
    hex (0 1 5 4 3 2 6 7) (1 1 200) simpleGrading (1 1 1)
);

edges
(
);

boundary
(
    inlet
    {
     type   cyclic;
     neighbourPatch outlet;
     faces ((0 3 7 4));
    }
    outlet
    {
     type   cyclic;
     neighbourPatch  inlet;
     faces  ((1 5 6 2));
    }
    top
    {
     type wall;
        faces ((7 6 2 3));
    }
    bottom
    {
     type wall;
     faces ((0 4 5 1));
    }
    frontAndBackPlanes
    {
    type empty;
    faces (
           (0 1 2 3)
           (4 7 6 5)
          );
    }
);

mergePatchPairs
(
);

// ************************************************************************* //

\endverbatim

The file first contains header information in the form of a banner (lines 1-7), then file information contained in a FoamFile sub-dictionary, delimited by curly braces ({…}).

The file first specifies coordinates of the block vertices; it then defines the blocks (here, only 1) from the vertex labels and the number of cells within it; and finally, it defines the boundary patches. The user is encouraged to consult the official documentation
<a href="http://cfd.direct/openfoam/user-guide/blockMesh/#x25-1750005.3">here</a>
to understand the meaning of the entries in the *blockMeshDict* file.


The mesh is generated by running blockMesh on this blockMeshDict file. From within the case directory, this is done, simply by typing in the terminal:

\verbatim
blockMesh
\endverbatim

The running status of blockMesh is reported in the terminal window. Any mistakes in the blockMeshDict file are picked up by blockMesh and the resulting error message directs the user to the line in the file where the problem occurred. There should be no error messages at this stage.


\paragraph BC_init Boundary and initial conditions

Once the mesh generation is complete, the user can look at this initial fields set up for this case. The case is set up to start at time t = 0 s, so the initial field data is stored in a 0_org sub-directory of the 1DSedim directory. The 0_org sub-directory contains several files: alpha_a, Ua, Ub, p_rbgh, muI, pa, Theta, one for each of the solid phase volume fraction (alpha_a), velocities of solid and fluid phases (Ua and Ub), the reduced pressure (p_rbgh) fields whose initial values and boundary conditions must be set. Let us examine file Ua:

\verbatim
dimensions      [0 1 -1 0 0 0 0];

internalField   uniform (0 0 0);

boundaryField
{
    inlet
    {
        type            cyclic;
    }
    outlet
    {
        type            cyclic;
    }
    top
    {
        type            zeroGradient;
    }
    bottom
    {
        type            fixedValue;
        value           uniform (0 0 0);
    }
    frontAndBackPlanes
    {
        type            empty;
    }
}

\endverbatim

There are 3 principal entries in field data files:


-dimensions:
    specifies the dimensions of the field, here velocity, i.e. m s\f$^{-1}\f$ ;

-internalField:
    the internal field data which are set to be uniform;

-boundaryField:
    the boundary field data that includes boundary conditions and data for all the boundary patches.

For this case 1DSedim, the boundary consists of cyclic boundaries at the inlet and outlet (left and right boundaries) and walls at the top and bottom boundaries, the top boundary is zeroGradient whereas the bottom boundary is a no-slip boundary conditions i.e zero velocity at the wall. The frontAndBack patch represents the front and back planes of the 2D case and therefore must be set as empty.

The user can similarly examine the fluid phase velocity field in the 0_org/Ub file. The solid phase volume fraction has zeroGradient boundary conditions at the top and bottom boundaries whereas the pressure has fixedValue at the top boundary (equivalent to setting the atmospheric pressure) and a fixedFluxPressure at the bottom boundary. We shall explain below what this boundary condition means.

\paragraph PhysProp Physical properties

The physical properties for the case are stored in dictionaries whose names are given the suffix …Properties, located in the Dictionaries directory tree. For a SedFoam case, there are 8 property files: transportProperties, interfacialProperties, ppProperties, granularRheologyProperties, kineticTheoryProperties, RASProperties  twophaseRASProperties

In the transport property file, the physical properties of the solid and fluid phases are set, such as density, kinematic viscosity and particle diameter.

\verbatim
// * * * * * * * * * * * * sediment properties * * * * * * * * * * * * //
phasea
{
    rho             rho [ 1 -3 0 0 0 ] 1050;
    nu              nu [ 0 2 -1 0 0 ] 1e-6;
    d               d [ 0 1 0 0 0 0 0 ] 290e-6;
    hExp            hExp [ 0 0  0 0 0 0 0 ] 3.15;  // hindrance exponent for drag: beta^(-hExp) (2.65 by default)
}
// * * * * * * * * * * * * fluid properties * * * * * * * * * * * * //
phaseb
{
    rho             rho [ 1 -3 0 0 0 ] 950;
    nu              nu [ 0 2 -1 0 0 ] 2.105e-05;
    d               d [ 0 1 0 0 0 0 0 ] 290e-6;
}
//*********************************************************************** //
transportModel  Newtonian;

nu              nu [ 0 2 -1 0 0 0 0 ] 2.105e-05;

nuMax           nuMax [0 2 -1 0 0 0 0] 1e0;      // viscosity limiter for the Frictional model (required for stability)

alphaSmall      alphaSmall [ 0 0 0 0 0 0 0 ] 1e-6;  // minimum volume fraction (phase a) for division by alpha 

\endverbatim

The hindrance function exponent of the Richardson-Zaki law can be tuned using the parameter hExp. This is important for this first test case which is in the laminar regime for the drag. The transportModel has to be prescribed when using turbulence model, it is present here for compatibility with the other test cases. The nuMax value is a viscosity limiter for the all the viscosities, it allows the user to control the numerical stability of the solver and will be discussed in the second test case. It is especially important as some shear stress terms are discretized explicitly and that the frictional viscosity can reach huge values. The alphaSmall value is used to regularise the division by alpha_a in the source code, the default value is set to \f$ 10^{-6} \f$.

The dictionary *interfacialProperties* allows to specify the drag model:

\verbatim
dragModela      GidaspowSchillerNaumann;

dragModelb      GidaspowSchillerNaumann;

dragPhase       a;
\endverbatim

The model chosen here is GidaspowSchilerNaumann that corresponds to the drag force around a spherical particle corrected by a hindrance function (\f$ \beta^{-hExp}\f$).

The dictionary *ppProperties* contains the information concerning the permanent contact contribution to the solid phase pressure. In SedFoam, the model of Johnson and Jackson (1987) is used:

\f$ p_{ff} = Fr \frac{\left( \alpha - \alpha_{min}^{Friction} \right)^{\eta}}{\left(\alpha_{Max} - \alpha \right)^p} \f$

\verbatim
ppModel          JohnsonJackson;

alphaMax         alphaMax [ 0 0 0 0 0 0 0 ] 0.635;

alphaMinFriction alphaMinFriction [ 0 0 0 0 0 0 0 ] 0.57;

Fr               Fr [ 1 -1 -2 0 0 0 0 ] 5e-2;

eta0             eta0 [ 0 0 0 0 0 0 0 ] 3;

eta1             eta1 [ 0 0 0 0 0 0 0 ] 5;

packingLimiter  no;

\endverbatim

And the dictionary *granularRheologyProperties* controls the granular rheology part:

\verbatim
granularRheology   on;

granularDilatancy  off;

alphaMaxG       alphaMaxG [ 0 0 0 0 0 0 0 ] 0.6;

mus             mus  [ 0 0 0 0 0 0 0 ] 0.24;

mu2             mu2  [ 0 0 0 0 0 0 0 ] 0.39;

I0              I0  [ 0 0 0 0 0 0 0 ] 0.01;

Bphi            Bphi [ 0 0 0 0 0 0 0 ] 1.;

n               n [ 0 0 0 0 0 0 0 ] 1.;

Dsmall          Dsmall [ 0 0 -1 0 0 0 0 ] 1e-4;

relaxPa         relaxPa [ 0 0 0 0 0 0 0 ] 1;

FrictionModel   Coulomb;

PPressureModel  none;

FluidViscosityModel Einstein;

<<<<<<< HEAD
\endverbatim 
=======
\endverbatim
>>>>>>> upstream/master

On the first line the switch granularRheology allows to turn on and off this module. The keywords FrictionModel, PPressureModel and FluidViscosityModel allow to choose the friction model, the shear induced particle pressure model and the effective viscosity model (see \ref inputs for details).

For the present case the granularRheology is set to Coulomb and the FluidViscosityModel is used for the effective viscosity model and a Einstein model is used. All the details concerning the different models can be found in the Geophysical Model Development paper on SedFoam.

The remaining dictionaries are not used for this tutorial and will not be detailed here. Their content will be explained in the next tutorials when they are used.

\paragraph control_sedFoam Control

Input data relating to the control of time and reading and writing of the solution data are read in from the controlDict dictionary. The user should view this file; as a case control file, it is located in the system directory.

The start/stop times and the time step for the run must be set. OpenFOAM offers great flexibility with time control which is described in full in section 4.3. In this tutorial we wish to start the run at time t = 0 which means that OpenFOAM needs to read field data from a directory named 0. Therefore we set the startFrom keyword to startTime and then specify the startTime keyword to be 0.

As the simulation progresses we wish to write results at certain intervals of time that we can later view with a post-processing package. The writeControl keyword presents several options for setting the time at which the results are written; here we select the adjustableRunTime option which specifies that results are written every writeInterval seconds of simulated time, adjusting the time steps to coincide with the writeInterval if necessary and the time step is automatically adjusted using adjustTimeStep = on. The time step controled using different criteria on Courant numbers based on the maximum velocity, the relative velocity (\f$ U_r=U_b-U_a \f$) and the interfacial courant number. The maximum values of the Courant numbers (maxCo and maxAlphaCo) are set in the controlDict and the maximum value of the time step is controlled by the parameter maxDeltaT.

OpenFOAM creates a new directory named after the current time, e.g. 20 s, on each occasion that it writes a set of data, as discussed in full in section 4.1. In the icoFoam solver, it writes out the results for each field, U and p, into the time directories. For this case, the entries in the controlDict are shown below:

\verbatim
application     sedFoam;

startFrom       latestTime;

startTime       0;

stopAt          endTime;

endTime         1800;

deltaT          1e-5;

writeControl    adjustableRunTime;

writeInterval   20;

purgeWrite      0;

writeFormat     ascii;

writePrecision  6;

timeFormat      general;

timePrecision   6;

runTimeModifiable on;

adjustTimeStep  on;

maxCo           0.3;

maxAlphaCo      0.3;

maxDeltaT       2e-1;

\endverbatim


\paragraph Disc_solv Discretisation and linear-solver settings

The numerical schemes and linear solvers are set in the system/fvSchemes and system/fvSolution files respectively.

Concerning the numerical schemes, the time discretisation is a Euler implicit scheme, the divergence terms are of Gauss limitedLinear type (2nd order centered schemes with a Sweby limiter) and the laplacian scheme is Gauss linear corrected for all terms. The fvScheme file is shown below:

\verbatim

ddtSchemes
{
    default         Euler implicit;
}

gradSchemes
{
        default         Gauss linear;
}

divSchemes
{
    default         none;
// alphaEqn
    div(phi,alpha)  Gauss upwind;//limitedLinear01 1;
    div(phir,alpha) Gauss upwind;//limitedLinear01 1;
// UEqn
    div(phia,Ua)    Gauss limitedLinearV 1;
    div(phib,Ub)    Gauss limitedLinearV 1;
    div(phiRa,Ua)   Gauss limitedLinear 1;
    div(phiRb,Ub)   Gauss limitedLinear 1;
// pEqn
    div(alpha,nu)   Gauss linear;
// alphaPlastic
    div(phia,alphaPlastic)   Gauss limitedLinear01 1;
// pa
    div(phia,pa_new_value)   Gauss limitedLinear 1;
}

laplacianSchemes
{
    default         none;
// UEqn
    laplacian(nuEffa,Ua) Gauss linear corrected;
    laplacian(nuEffb,Ub) Gauss linear corrected;
    laplacian(nuFra,Ua)  Gauss linear corrected;
// pEqn
    laplacian((rho*(1|A(U))),p_rbgh) Gauss linear corrected;
}

interpolationSchemes
{
    default  linear;
}

snGradSchemes
{
    default         corrected;
}

fluxRequired
{
    default         no;
    p_rbgh               ;
}

\endverbatim

In the system/fvSolution file, the user can specify the linear solver he/she wants to use for each equation and the tolerance for the resolution. The user can also control the number of corrector steps and non-orthogonal correctors (useless for cartesian grids) for the PIMPLE algorithm. In the present case, a single PIMPLE corrector is enough the residual of the pressure equation is shown to converge well. The fvSolution file is reproduced below:

\verbatim

solvers
{
    p_rbgh
    {
        solver          GAMG;
        tolerance       1e-9;
        relTol          0.0001;
        smoother        DIC;
        nPreSweeps      0;
        nPostSweeps     2;
        nFinestSweeps   2;
        cacheAgglomeration true;
        nCellsInCoarsestLevel 10;
        agglomerator    faceAreaPair;
        mergeLevels     1;
    }

    p_rbghFinal
    {
        $p_rbgh;
        tolerance       1e-9;
        relTol          0;
    }
    "(alpha_a|Ua|Ub|pa_new_value|alphaPlastic)"
    {
        solver          PBiCG;
        preconditioner  DILU;
        tolerance       1e-9;
        relTol          0;
    }
    "(alpha_aFinal|UaFinal|UbFinal|paFinal|alphaPlasticFinal)"
    {
        solver          PBiCG;
        preconditioner  DILU;
        tolerance       1e-9;
        relTol          0;
    }
}

PIMPLE
{
    momentumPredictor 0;
    nOuterCorrectors  1;
    nCorrectors     1;
    nNonOrthogonalCorrectors 0;
    correctAlpha    0;
    nAlphaCorr      1;
    pRefCell        0;
    pRefValue       0;
}


relaxationFactors
{
    fields
    {
        p_rbgh               1.;
        p_rbghFinal          1;
    }
    equations
    {
        "Ua|Ub|k|omega"             1.;
        "(Ua|Ub|k|omega)Final"      1;
    }

}
\endverbatim

\subsection run_sedFoam Running sedFoam_rbgh

The easiest way to run the test case is to run the shell script:

\verbatim
#!/bin/sh

# Create the mesh
blockMesh

# create the intial time folder
cp -r 0_org 0

# Run sedFoam
sedFoam_rbgh > log&
\endverbatim

The script is self documented, the blockMesh command has already been introduced. The initial condition stored in the 0_org folder is first copied to the zero (0) folder. The initial condition for solid phase volume fraction profile *alpha_a* is set using codeStream following an hyperbolic tangent profile described in the file *0_org/alpha_a* as follows:

\verbatim
internalField   #codeStream
{
    codeInclude
    #{
        #include "fvCFD.H"
    #};

    codeOptions
    #{
        -I$(LIB_SRC)/finiteVolume/lnInclude \
        -I$(LIB_SRC)/meshTools/lnInclude
    #};
    codeLibs
    #{
        -lfiniteVolume \
        -lmeshTools
    #};
    code
    #{
        const IOdictionary& d = static_cast<const IOdictionary&>(dict);
	    const fvMesh& mesh = refCast<const fvMesh>(d.db());
        scalarField alpha_a(mesh.nCells(), 0);

        forAll(mesh.C(), i)
        {
            scalar y = mesh.C()[i].y();
            if (y < 0.049)
            {
                alpha_a[i] = 0.5;
            }
            else
            {
                alpha_a[i] = 0.5*0.5*(1.0+tanh((y-0.054)/(0.0490-y)*10.0));
            }
        }
// OpenFoam.com version and Old OpenFoam.org (<= 6)
        alpha_a.writeEntry("", os);
// New OpenFoam.org version (>=7)
//        writeEntry(os, "", alpha_a);
    #};
\endverbatim


The code is run using the command sedFoam_rbgh in the terminal. The "> log &" allows to run the code in batch and write the output in the file log. The run can be monitored using the command 


\verbatim
tail -100 log
\endverbatim

// comment: Shall we replace the batch execution by an interactive run to avoid beginners to run multiple times the code without knowing how to kill the process.

\subsection post Post-processing

\paragraph postparaview Using paraview

The reader is reffered to the OpenFOAM tutorial for the lid driven cavity for the basic manipulation on paraview such as viewing loading the data or viewing the mesh (http://cfd.direct/openfoam/user-guide/cavity/).

\paragraph postfluidfoam Using fluidfoam

The postprocessing using python requires the installation of the package fluidfoam available at git clone https://github.com/fluiddyn/fluidfoam. If the package is installed properly with all the dependencies, you just have to run the python script *plot_tuto1DSedim.py* located in the folder *tutorials/Py*:

\verbatim
python plot_tuto1DSedim.py
\endverbatim 

and you should see the following figures:

@image html "res1_tuto1.png" "Figure 2: Comparison of two-phase numerical results with experiments of Pham Van Bang et al. (2006) for the settling curves: time evolution of the lower and upper interface positions (circles: experiments ; lines: model).  " width=600px
@image latex "res1_tuto1.png" "Figure 2: Comparison of two-phase numerical results with experiments of Pham Van Bang et al. (2006) for the settling curves: time evolution of the lower and upper interface positions (circles: experiments ; lines: model)."

@image html "res2_tuto1.png" "Figure 3: Comparison of two-phase numerical results with experiments of Pham Van Bang et al. (2006) for solid phase volume fraction profiles (dashed blue lines: experiment ; solid red lines: model)." width=600px
@image latex "res2_tuto1.png" "Figure 3: Comparison of two-phase numerical results with experiments of Pham Van Bang et al. (2006) for solid phase volume fraction profiles (dashed blue lines: experiment ; solid red lines: model). "

\section BedLoadCLB 1DBedload: Laminar bedLoad


We consider a flat particle bed submitted to a Poiseuille
flow driven by a pressure gradient in a horizontal channel. This situation has been studied experimentally, analytically and numerically by Ouriemi et al. (2009) and Aussillous et al. (2013). The goal of this tutorial is to illustrate the ability of SedFoam to reproduce dense granular flows using the dense granular flow rheology \f$\mu(Iv)\f$. For this purpose SedFoam will be first compared with the analytical solution from Aussillous et al. (2013) using a Coulomb friction rheology. In a second part, the results obtained using the \f$\mu(Iv)\f$ rheology are compared with a simple 1D numerical model.

@image html "LaminarBedloadIndexMatching.jpg" "Figure 4: Image from an index matching laminar bed-load experiment (Aussillous et al, 2013).  " width=600px
@image latex "LaminarBedloadIndexMatching.jpg" "Figure 4: Image from an index matching laminar bed-load experiment (Aussillous et al, 2013)."



\subsection preprocBL Pre-processing

This tutorial is distributed with sedFoam3.0 under the folder *sedFoamDirectory/tutorials/1DBedLoad*.

\paragraph meshgenBL Mesh generation

The numerical domain consists of a square of side length L = 0.0065 m in the x-y plane and of height h=0.065 m in the vertical direction z. The side length is chosen to ensure a unity cell aspect ratio. A uniform mesh of 1 by 1 by 200 cells will be used. The block structure is the same as for the Sedimentation test case and is shown in Figure 1.

The mesh is generated by running blockMesh from within the case directory:

\verbatim
blockMesh
\endverbatim

\paragraph BC_initiBL Boundary and initial conditions

The case is set up to start at time t = 0 s, again the initial field data are stored in a 0_org sub-directory of the case directory. The 0_org sub-directory contains several files: alpha_a, alphaMinFriction, alphaPlastic, Ua, Ub, p_rbgh, muI, pa, pa_new, Theta, one for each of the solid phase volume fraction (alpha_a), velocities of solid and fluid phases (Ua and Ub), the reduced pressure (p_rbgh) fields whose initial values and boundary conditions must be set. Compared with the sedimentation test case, no-slip boundary conditions are imposed for both phase velocity at the top and bottom boundaries.

\paragraph PhysPropBL Physical properties

The transportProperties file for the 1DBedload case is shown below:

\verbatim
// * * * * * * * * * * * * sediment properties * * * * * * * * * * * * //
phasea
{
    rho             rho [ 1 -3 0 0 0 ] 1190;
    nu              nu [ 0 2 -1 0 0 ] 1e-6;
    d               d [ 0 1 0 0 0 0 0 ] 2.e-3;
}

phaseb
{
    rho             rho [ 1 -3 0 0 0 ] 1070;
    nu              nu [ 0 2 -1 0 0 ] 2.52e-4;
    d               d [ 0 1 0 0 0 0 0 ] 2.e-3;
}
//*********************************************************************** //
transportModel  Newtonian;

nu              nu [ 0 2 -1 0 0 0 0 ] 2.52e-4;

nuMax           nuMax [0 2 -1 0 0 0 0] 1e1;      // viscosity limiter for the Frictional model (required for stability)

alphaSmall      alphaSmall [ 0 0 0 0 0 0 0 ] 1e-6;  // minimum volume fraction (phase a) for division by alpha_a

\endverbatim

The physical property of the particles (diameter and density) and of the fluid (density and kinematic viscosity) have been set to the experimental values from Aussillous et al. (2013).

In the dictionary *interfacialProperties* file the drag model from GidaspowShcillerNaumann has been kept, the influence of the drag model on this test case as the relative velocity between the fluid and the particles is negligible.

Compared with the sedimentation test case, the *granularRheologyProperties* is critical. The file is shown below:

\verbatim
granularRheology   on;

granularDilatancy  off;


alphaMaxG       alphaMaxG [ 0 0 0 0 0 0 0 ] 0.6;

mus             mus  [ 0 0 0 0 0 0 0 ] 0.32;

mu2             mu2  [ 0 0 0 0 0 0 0 ] 0.94;

I0              I0  [ 0 0 0 0 0 0 0 ] 0.0077;

Bphi            Bphi [ 0 0 0 0 0 0 0 ] 1.0;

n               n [ 0 0 0 0 0 0 0 ] 2.5;

Dsmall          Dsmall [ 0 0 -1 0 0 0 0 ] 1e-4;

relaxPa         relaxPa [ 0 0 0 0 0 0 0 ] 1;

FrictionModel  Coulomb;
//FrictionModel  MuIv;

PPressureModel  none;

FluidViscosityModel  Einstein;

\endverbatim

To compare with the analytical solution, the Coulomb Frictional model and the Einstein FluidViscosity model are used. No PPressureModel is specified meaning that the shear induced contribution to the solid phase pressure is not included i.e. the solid phase volume fraction profile must be sharp at the particle bed interface. The value of the rheological constants are chosen following Aussillous et al. (2013). The regularisation parameter Dsmall is taken as 1e-4, this is shown to be enough for this case but a sensitivity analysis could be performed in case of a too strong creeping flow in the particle bed.

\paragraph Disc_solvBL Discretisation and linear-solver settings

The numerical schemes and the solvers are the same as in the 1DSedim case.

\paragraph control_sedFoamBL Control

The system/controlDict file is modified compared with the sedimentation test case. The endTime is fixed to 350 s with an output every 50s with an adjustable time step limited to 5e-3 s.

\verbatim
application     sedFoam;

startFrom       latestTime;

startTime       0;

stopAt          endTime;

endTime         350;

deltaT          0.005;

writeControl    adjustableRunTime;

writeInterval   50.;

purgeWrite      0;

writeFormat     ascii;

writePrecision  6;

timeFormat      general;

timePrecision   6;

runTimeModifiable on;

adjustTimeStep  yes;

maxCo           0.1;

maxAlphaCo      0.1;

maxDeltaT       5e-03;
\endverbatim

\subsection postBL Post-processing using python

You just have to run the python script *plot_tuto1DBedLoadCLB.py* located in the folder *tutorials/Py*:

\verbatim
python plot_tuto1DBedLoadCLB.py
\endverbatim

and you should see the following figures:

@image html "res1_tuto2.png" "Figure 5: Comparison of the streamwise velocity profiles for the flow of a Newtonian fluid over a granular bed having a Coulomb rheology between two infinite parallel planes obtained by numerical simulations with the analytical solution of Ouriemi et al. (2009) in terms of volume fraction (left panel), velocity profiles (middle panel) and particle pressure (right panel) profiles." width=800px
@image latex "res1_tuto2.png" "Figure 5: Comparison of the streamwise velocity profiles for the flow of a Newtonian fluid over a granular bed having a Coulomb rheology between two infinite parallel planes obtained by numerical simulations with the analytical solution of Ouriemi et al. (2009) in terms of volume fraction (left panel), velocity profiles (middle panel) and particle pressure (right panel) profiles. "

\subsection ExtensionBL  Extension to the Mu(Iv) rheology

The same configuration can be run using the \f$\mu(Iv)\f$ rheology by modifying the *endTime* from 350 to 450 in *system/controlDict* file:

\verbatim
endTime		450;
\endverbatim

and the constant/granularRheologyProperties file in the following way:

\verbatim
//FrictionModel  Coulomb;
FrictionModel  MuIv;
\endverbatim

And run the code again using the command:

\verbatim
sedFoam_rbgh > log2&
\endverbatim

At the end of the run, the run can be post-processed using the python script:

\verbatim
python plot_tuto1DBedLoadMUI.py
\endverbatim

that results in the following figures:

@image html "res2_tuto2.png" "Figure 6: Comparison of the streamwise velocity profiles for the flow of a Newtonian fluid over a granular bed having a mu(Iv) rheology between two infinite parallel planes obtained by numerical simulations with  one-dimensional numerical solution presented in Aussillous et al. (2013) in terms of volume fraction (left panel), velocity profiles (middle panel) and particle pressure (right panel) profiles." width=800px
@image latex "res2_tuto2.png" "Figure 6: Comparison of the streamwise velocity profiles for the flow of a Newtonian fluid over a granular bed having a mu(Iv) rheology between two infinite parallel planes obtained by numerical simulations with  one-dimensional numerical solution presented in Aussillous et al. (2013) in terms of volume fraction (left panel), velocity profiles (middle panel) and particle pressure (right panel) profiles. "


\section BedLoadTurb 1DBedloadTurb: Turbulent bedload transport

The aim of this tutorial is to reproduce, with sedFOAM, coupled fluid-discrete element method (DEM) simulations of turbulent bedload transport. In DEM simulations, the motion of each particles is solved individually. The source code is YADE (Smilauer et al. 2015) and the coupling with the fluid phase presented in Maurin et al. (2015). Averaged quantities are computed in the DEM (packing fraction, particle velocity, …) which will be considered as a basis to compare with the sedFoam code.
First the \f$\mu(Iv)\f$ rheology for bedload transport of Maurin et al. (2016) will be used. Another possibility is to use the Kinetic Theory of granular gas to close the particle stresses. We will show how this can be done in sedfoam.

@image html "DEM_setup.png" "Figure 5: Turbulent bedload simulation with coupled fluid-DEM simulation.  " width=600px
@image latex "DEM_setup.png" "Figure 5: Turbulent bedload simulation with coupled fluid-DEM simulation."

\subsection preprocBLTurb Pre-processing

This tutorial is distributed with sedFoam3.0 under the folder *sedFoamDirectory/tutorials/1DBedLoadTurb*.

\paragraph meshgenBLTurb Mesh generation

The numerical domain consists of a square of side length L = 0.00147 m in the x-y plane and of height h=0.147 m in the vertical direction z. The side length is chosen to ensure a unity cell aspect ratio. A uniform mesh of 1 by 1 by 120 cells will be used. The block structure is the same as for the Sedimentation test case and is shown in Figure 1.

The mesh is generated by running blockMesh from within the case directory:

\verbatim
blockMesh
\endverbatim

\paragraph BC_initiBLTurb Boundary and initial conditions

The case is set up to start at time \f$t = 0\f$ s, again the initial field data are stored in a 0_org sub-directory of the case directory. The 0_org sub-directory contains several files: alpha_a, alphaMinFriction, alphaPlastic, Ua, Ub, p_rbgh, muI, pa, pa_new, Theta, one for each of the solid phase volume fraction (alpha_a), velocities of solid and fluid phases (Ua and Ub), the reduced pressure (p_rbgh) fields whose initial values and boundary conditions must be set. The initial profile of concentration (in alpha_a) is a hyperbolic tangent whose parameters have been compute so that the exact same amount of granular mass as in the DEM simulation is set in the sedFoam simulation. Compared with the sedimentation test case, no-slip boundary conditions are imposed for both phase velocity at the top and bottom boundaries.

\verbatim
forAll(mesh.C(), i)
{
 scalar y = mesh.C()[i].y();
        alpha_a[i] = 0.305*(1.0+tanh((12.5*0.006-y)/0.005));
}
\endverbatim

\paragraph PhysPropBLTurb Physical properties

The transportProperties file for the 1DBedloadTurb case is shown below.

\verbatim
// * * * * * * * * * * * * sediment properties * * * * * * * * * * * * //
phasea
{
    rho             rho [ 1 -3 0 0 0 ] 2500;
    nu              nu [ 0 2 -1 0 0 ] 1e-6;
    d               d [ 0 1 0 0 0 0 0 ] 6.e-3;
    sF              sF   [ 0 0  0 0 0 0 0 ] 1;    // shape Factor to adjust settling velocity for non-spherical particles
    hExp            hExp [ 0 0  0 0 0 0 0 ] 3.1;  // hindrance exponent for drag: beta^(-hExp) (2.65 by default)
}
// * * * * * * * * * * * * fluid properties * * * * * * * * * * * * //
phaseb
{
    rho             rho [ 1 -3 0 0 0 ] 1000;
    nu              nu [ 0 2 -1 0 0 ] 1.e-6;
    d               d [ 0 1 0 0 0 0 0 ] 3.e-3;
    sF              sF   [ 0 0  0 0 0 0 0 ] 0.5;
    hExp            hExp [ 0 0  0 0 0 0 0 ] 3.1;
}
//*********************************************************************** //
transportModel  Newtonian;

nu              nu [ 0 2 -1 0 0 0 0 ] 1.e-6;

nuMax           nuMax [0 2 -1 0 0 0 0] 1e2;      // viscosity limiter for the Frictional model (required for stability)

alphaSmall      alphaSmall [ 0 0 0 0 0 0 0 ] 1e-5;  // minimum volume fraction (phase a) for division by alpha

// ************************************************************************* //
\endverbatim

The physical property of the particles (diameter and density) and of the fluid (density and kinematic viscosity) have been set to the DEM values.

The fluid and particles are submitted to gravity. This is accounted as a pressure gradient source term in the momentum conservation equations. It corresponds to gradPMEAN in file *forceProperties* with \f$gradPMEAN = \rho^f g S_0 \f$, with \f$\rho^f=1000\f$ (kg/s), \f$g=9.81\f$ (m/s^2) and \f$S_0 = 0.05\f$. The tilt parameter is set to 1, so that the source term in the granular momentum equation is automatically set to \f$gradPMEAN = \rho^p g S_0 \f$.
\verbatim
// * * * * * * * * * * * * * following are for presure * * * * * * * * * * * * * * * //
gradPMEAN        gradPMEAN        [ 1 -2 -2 0 0 0 0 ] (490.5 0 0 ); // mean pressure

tilt             tilt             [ 0  0  0 0 0 0 0 ] 1; // To impose same gravity term to both phases

Cvm             Cvm [ 0 0 0 0 0 ] 0;                // Virtual/Added Mass coefficient

Cl              Cl [ 0 0 0 0 0 ] 0;                 // Lift force coefficient

Ct              Ct [ 0 0 0 0 0 ] 0;                 // Eddy diffusivity coefficient for phase a

debugInfo       true;

writeTau        true;

// * * * * * * * * * * * * end of definition of pressure * * * * * * * * * * * * * //
\endverbatim

The fluid turbulence is modelled with a mixing length approach with the same parameters as in the DEM fluid model (expoLM=1, kappaLM=0.41, alphaMaxLM=0.61) :

\verbatim
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
simulationType  RAS;

RAS{
RASModel        twophaseMixingLength;
//RASModel        twophasekEpsilon;
//RASModel        twophasekOmega;

turbulence      on;
printCoeffs     on;

twophaseMixingLengthCoeffs
{
expoLM 1.0;
alphaMaxLM 0.61;
kappaLM 0.41;
}
}
// ************************************************************************* //
\endverbatim

In the dictionary *interfacialProperties* file the drag model from DallaValle is used (as in the DEM).

Kinetic theory will be used to compute the kinetic contributions of granular stresses. Be sure to set granularRheology to off in *granularRheologyProperties*. The *kineticTheoryProperties* file is described just below:

\verbatim
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

kineticTheory   on;

limitProduction off;

extended        off;

e               e [ 0 0 0 0 0 0 0 ] 0.7;

muPart          muPart [ 0 0 0 0 0 0 0 ] 0.4;

alphaMax        alphaMax [ 0 0 0 0 0 0 0 ] 0.635;

MaxTheta       MaxTheta [ 0 2 -2 0 0 0 0 ] 0.5;

phi             phi [ 0 0 0 0 0 0 0 ] 20.487; //mus = 0.35 = sin(phi*pi/180)

psi             psi [ 0 0 0 0 0 0 0 ] 0.0;

killJ2_       killJ2_ [ 0 0 0 0 0 0 0] 1;

quadraticCorrectionJ1_ quadraticCorrectionJ1_ [ 0 0 0 0 0 0 0 ] 1;

viscosityModel  GarzoDuftyMod;

conductivityModel GarzoDuftyMod;

granularPressureModel Lun;

radialModel     ChialvoSundaresanFric;

// ************************************************************************* //
\endverbatim

As in the DEM, particles with interparticle friction \f$\mu = 0.4\f$ and restitution coefficient \f$e=0.7\f$ are considered. The Garzo & Dufty (1999) model for the kinetic theory coefficients is used, slightly modified to correct discrepancies observed in the dilute part of the flow. The pressure model of Lun et al. (1984) is the same as the one of Garzo & Dufty (1999). The radial distribution function used is the one of Chialvo & Sundaresan (2013), modified to account for interparticular friction.

\paragraph Disc_solvBLTurb Discretisation and linear-solver settings

The numerical schemes and the solvers are the same as in the 1DSedim case.

\paragraph control_sedFoamBLTurb Control

The system/controlDict file is shown thereafter. The endTime is fixed to 30 s with an output every 5s with an adjustable time step limited to 5e-3 s. The simulation should last around 20 minutes.

\verbatim
application     sedFoam;

startFrom       latestTime;

startTime       0;

stopAt          endTime;

endTime         30;

deltaT          1e-5;

writeControl    adjustableRunTime;

writeInterval   1;

purgeWrite      0;

writeFormat     ascii;

writePrecision  6;

timeFormat      general;

timePrecision   6;

runTimeModifiable on;

adjustTimeStep  on;

maxCo           0.1;

maxAlphaCo      0.1;

maxDeltaT       1e-3;
\endverbatim

\subsection postBLTurb Post-processing using python

You just have to run the python script *plot_tuto1DBedLoadTurb.py* located in the folder *tutorials/Py*:

\verbatim
python plot_tuto1DBedLoadTurb.py
\endverbatim

and you should see the following figures:

@image html "res_TutoBedloadTurb.png" "Figure 6: Turbulent flow over a granular bed. Comparison with DEM data of the packing fraction, particle and fluid streamwise velocity, transport profile and granular temperature." width=800px
@image latex "res_TutoBedloadTurb.png" "Figure 6: Comparison with DEM data of the packing fraction, particle streamwise velocity and fluid streamwise profiles for a turbulent flow over a granular bed. "


\section  dryavalanche 1DAvalancheMuI: Dry granular avalanche


We consider a fluid-solid mixture avalanche flowing under a steady-state moving down a planar slope as illustrated in figure 7.
In this example, dense granular flow is reproduced by means of the dense granular flow rheology \f$\mu(I)\f$.
Numerical results are contrasted with the analytical solution (Bagnold's solution).


@image html "schemeAvalanche1DInertial.png" "Figure 7: Schematic section of the dry avalanche flowing down on a uniform slope.  The coordinate system and main lengths are defined." width=500px
@image latex "schemeAvalanche1DInertial.png" "Figure 7: Schematic section of the dry avalanche flowing down on a uniform slope.  The coordinate system and main lengths are defined."


\subsection preprocAva Pre-processing


This tutorial is distributed with sedFoam5.0 under the folder *sedFoamDirectory/tutorials/1DAvalancheMuI*.

\paragraph meshgenAva Mesh generation


Because the avalanche is assumed to be in a stationary state, the simulation can be easily reduced to a one-dimensional problem.  The numerical domain consists of a square of side length L = 0.01 made dimensionless by the domain size in the x-y plane and of height h=1 in the vertical direction z. 

A uniform mesh of 1 by 1 by 100 cells will be used (see \f$ n_{x}\f$=1 and \f$ n_{z}\f$=100 in figure 6). The block structure is the same as for the Sedimentation test case and is shown in figure 1.



The mesh is generated by running blockMesh from within the case directory:

\verbatim
blockMesh
\endverbatim


\paragraph  BC_initiAva Boundary and initial conditions




The case is set up to start at time t = 0 s, again the initial field data are stored in a 0_org sub-directory of the case directory. The 0_org sub-directory contains several files: alpha_a, Ua, Ub, p_rbgh, muI, pa, Theta, one for each of the solid phase volume fraction (alpha_a), velocities of solid and fluid phases (Ua and Ub), the reduced pressure (p_rbgh) fields whose initial values and boundary conditions must be set.
No-slip boundary conditions are imposed for both phases at the top and bottom boundaries (zero velocity at the solid boundaries).  Additionally, cyclic boundaries are considered in the inlet and outlet (upstream and downstream boundaries in figure 6.). Cyclic boundaries are imposed to connect two equal meshes.
The frontAndBack patch represents the front and back planes of the 2D case and therefore must be set as empty.


\paragraph PhysPropAva Physical properties


The following variables are considered:


<table>
<caption id="multi_row">Main physical parameters.</caption>
<tr><th>Properties   <th>Value
<tr><td>Solid density   <td>\f$\rho_p=1 \frac{kg}{m^3}\f$
<tr><td>Fluid density    <td>\f$\rho_f=10^{-3} \frac{kg}{m^3}\f$
<tr><td>Fluid viscosity     <td>\f$\nu^f=10^{-1} \frac{m^2}{s}\f$
<tr><td>Mean particle diameter    <td>\f$d=0.02 m\f$
<tr><td>Slope inclined at the angle    <td>\f$\theta=26^o \f$
<tr><td>Solid phase thickness   <td>\f$h=0.5 m\f$
<tr><td>Initial solid volume fraction   <td>\f$\phi=0.6\f$
</table>



The *transportProperties* file for the 1DAvalancheMuI case is shown below:

\verbatim
phasea
{
    rho             rho [ 1 -3 0 0 0 ] 1;
    nu              nu [ 0 2 -1 0 0 ] 1e-6;
    d               d [ 0 1 0 0 0 0 0 ] 0.02;
}

phaseb
{
    rho             rho [ 1 -3 0 0 0 ] 1e-3;
    nu              nu [ 0 2 -1 0 0 ] 1e-1;
    d               d [ 0 1 0 0 0 0 0 ] 1;
}
//*********************************************************************** //
transportModel  Newtonian;

nu              nu [ 0 2 -1 0 0 0 0 ] 1e-1;

// Diffusivity for mass conservation resolution (avoid num instab around shocks)
alphaDiffusion  alphaDiffusion [0 2 -1 0 0 0 0] 0e0;

nuMax           nuMax [0 2 -1 0 0 0 0] 1e2;      // viscosity limiter for the Frictional model (required for stability)

alphaSmall      alphaSmall [ 0 0 0 0 0 0 0 ] 1e-6;  // minimum volume fraction (phase a) for division by alpha


\endverbatim


Dense granular flow rheology \f$\mu(I)\f$ is used as shown in *granularRheologyProperties*:




\verbatim

granularRheology   on;

granularDilatancy  off;

alphaMaxG       alphaMaxG [ 0 0 0 0 0 0 0 ] 0.6;

mus             mus  [ 0 0 0 0 0 0 0 ] 0.38;

mu2             mu2  [ 0 0 0 0 0 0 0 ] 0.64;

I0              I0  [ 0 0 0 0 0 0 0 ] 0.3;

Bphi            Bphi [ 0 0 0 0 0 0 0 ] 0.31;

n               n [ 0 0 0 0 0 0 0 ] 2.5;

BulkFactor      BulkFactor [ 0 0 0 0 0 0 0 ] 0e0;

PaMin           PaMin [ 0 0 0 0 0 0 0 ] 1e-6;

relaxPa         relaxPa [ 0 0 0 0 0 0 0 ] 1;

tau_inv_min     tau_inv_min [ 0 0 -1 0 0 0 0 ] 1e-3;

FrictionModel   MuI;

PPressureModel  MuI;

FluidViscosityModel  none;

\endverbatim




Additionally,  *FluidViscosityModel* model is set to *none*. Even though no *FluidViscosityModel* is specified,  the shear induced contribution associated to the fluid phase is still present. However, it has insignificant influence
on the results due to the low fluid viscosity. On the contrary, the analytical solution assumes that shear induced contribution to the fluid phase is null.


Finally, the file  *constant/g* is modified to take into account the \f$x\f$ and \f$y\f$-axis  component of gravity with magnitude \f$g=1\f$. In this work the plane is inclined  to \f$\theta=26^o \f$, however, other angles may be considered.




\verbatim

dimensions      [0 1 -2 0 0 0 0];

// tilt angle = 26 deg
value           (0.43837 -0.89879 0);

\endverbatim




\subsection postAvalanche Post-processing using python


The analytical and SedFoam results are obtained running the python script *plot_tuto1DAvalancheMuI.py* located in the folder *tutorials/Py*:


\verbatim
python plot_tuto1DAvalancheMuI.py
\endverbatim

and you should see the following figure:

@image html "res1_tuto_avalanche.png" "Figure 8: Evolution of a) solid volume fraction, b) velocity, c) solid phase pressure, d) mu(I), e) shear stress f) frictional viscosity, and g) shear rate in function of height (y). Results are expressed in dimensionless terms." width=800px
@image latex "res1_tuto_avalanche.png" "Figure 8: Evolution of a) solid volume fraction, b) velocity, c) solid phase pressure, d) mu(I), e) shear stress f) frictional viscosity, and g) shear rate in function of height (y). Results are expressed in dimensionless terms."





\section  wetvalanche 1DWetAvalancheMuIv: Immersed granular avalanche


We consider a fluid-solid mixture avalanche flowing under a steady-state moving down a planar slope as illustrated in figure 9. In contrast to
previous tutorial, the granular material is immersed in a viscous fluid. Therefore, dense granular flow rheology \f$\mu(I_v)\f$ is used instead.
Additionally, dilatancy effects are included in this example.  Iverson et al.(2000) showed the  initial dynamics of underwater avalanches strongly
depend on the initial volume fraction: initially loose granular beds are  instantaneously mobilized after tilting the plane whereas
in initially dense granular beds, the motion of the avalanche is delayed. This mechanism is accompanied by an expansion (initially dense) or contraction  (initially loose)
of the granular medium that modifies the pore space.  Consequently,  negative (dense packings) or positive (loose packings)
 excess  pore pressures develop within the mixture. In this example, we
 reproduce a dense granular avalanche \f$(\phi_0=0.592)\f$  in 1D. In order to reach an initial equilibrium state,
 200 seconds are required to let the granular layer deposit by gravity.


@image html "schemeAvalanche1DVisc.png" "Figure 9: Schematic section of the immersed avalanche in a viscous fluid flowing down on a uniform slope.  The coordinate system and main lengths are defined." width=500px
@image latex "schemeAvalanche1DVisc.png" "Figure 9: Schematic section of the immersed avalanche in a viscous fluid flowing down on a uniform slope.  The coordinate system and main lengths are defined."




\subsection preprocWetAva Pre-processing


This tutorial is distributed with sedFoam5.0 under the folder *sedFoamDirectory/tutorials/1DWetAvalanche*.


\paragraph PhysPropWetAva Physical properties


The following variables are considered to reproduce the experimental results of Pailha et al. (2008):


<table>
<caption id="multi_row">Main physical parameters.</caption>
<tr><th>Properties   <th>Value
<tr><td>Solid density   <td>\f$\rho_p=2500 \frac{kg}{m^3}\f$
<tr><td>Fluid density    <td>\f$\rho_f=1041 \frac{kg}{m^3}\f$
<tr><td>Fluid viscosity     <td>\f$\nu^f=9.2 \cdot 10^{-5} \frac{m^2}{s}\f$
<tr><td>Mean particle diameter    <td>\f$d=160 \cdot 10^{-6} m\f$
<tr><td>Slope inclined at the angle    <td>\f$\theta=25^o \f$
<tr><td>Solid phase thickness   <td>\f$h=0.0049 m\f$
<tr><td>Initial solid volume fraction   <td>\f$\phi=0.592\f$
</table>



The *transportProperties* file for the 1DWetAvalancheMuIv case is shown below:

\verbatim
phasea
{
    rho             rho [ 1 -3 0 0 0 ] 2500;
    nu              nu [ 0 2 -1 0 0 ] 1e-6;
    d               d [ 0 1 0 0 0 0 0 ] 160.e-6;
}

phaseb
{
    rho             rho [ 1 -3 0 0 0 ] 1041.;
    nu              nu [ 0 2 -1 0 0 ] 9.221902017291067e-05;
    d               d [ 0 1 0 0 0 0 0 ] 2.e-3;
}
//*********************************************************************** //
transportModel  Newtonian;

nu              nu [ 0 2 -1 0 0 0 0 ] 9.221902017291067e-05;

// Diffusivity for mass conservation resolution (avoid num instab around shocks)
alphaDiffusion  alphaDiffusion [0 2 -1 0 0 0 0] 0e-8;

nuMax           nuMax [0 2 -1 0 0 0 0] 1e0;      // viscosity limiter for the Frictional model (required for stability)

alphaSmall      alphaSmall [ 0 0 0 0 0 0 0 ] 1e-6;  // minimum volume fraction (phase a) for division by alpha


\endverbatim



\subsection SedimentationWetAva Sedimentation process

Dense granular flow rheology \f$\mu(I_v)\f$ is used as shown in *granularRheologyProperties*.
The dilatancy model is switch off during the sedimentation process:




\verbatim
granularRheology   on;

<<<<<<< HEAD
granularDilatancy  off;

alphaMaxG       alphaMaxG [ 0 0 0 0 0 0 0 ] 0.62;
=======
granularDilatancy  on;
>>>>>>> upstream/master

alphaMaxG       alphaMaxG [ 0 0 0 0 0 0 0 ] 0.62;

mus             mus  [ 0 0 0 0 0 0 0 ] 0.425;

mu2             mu2  [ 0 0 0 0 0 0 0 ] 0.765;

I0              I0  [ 0 0 0 0 0 0 0 ] 0.004;

Bphi            Bphi [ 0 0 0 0 0 0 0 ] 1.0;

n               n [ 0 0 0 0 0 0 0 ] 2.5;

Dsmall          Dsmall [ 0 0 -1 0 0 0 0 ] 1e-6;

BulkFactor      BulkFactor [ 0 0 0 0 0 0 0 ] 0e0;

relaxPa         relaxPa [ 0 0 0 0 0 0 0 ] 1.0;

K_dila          K_dila [ 0 0 0 0 0 0 0 ] 4.0;

alpha_c         alpha_c [ 0 0 0 0 0 0 0 ] 0.585;

FrictionModel   MuIv;

PPressureModel  MuIv;

FluidViscosityModel  BoyerEtAl;

\endverbatim




If you wish a different initial volume fraction you need to adjust the *0_org/alphaPlastic* file accordingly.
Reference values: *alphaPlastic=0.575* leads to \f$\phi_0=0.592\f$, *alphaPlastic=0.545* leads to \f$\phi_0=0.571\f$
and *alphaPlastic=0.520* leads to \f$\phi_0=0.566\f$.



\subsection WetAvaProc Launching the 1D immersed avalanche


After 200 seconds of sedimentation,
the file *constant/g* should be adjusted to reproduce the inclined plane (25 degrees slope):



\verbatim

dimensions      [0 1 -2 0 0 0 0];
// tiltangle = 25°
value           ( 4.14588187090559 -8.8908809188120586 0 );

\endverbatim




The dilatancy model is turn on in *granularRheologyProperties* to reproduce the coupling between the dilatancy
 and the pore pressure feedback:


\verbatim

granularDilatancy  on;

\endverbatim




\subsection postWetAvalanche Post-processing using python


The SedFoam and Pailha et al. (2008) experimental results are obtained running the python script *plot_tuto1DWetAvalanche.py*
located in the folder *tutorials/Py*:


\verbatim
python plot_tuto1DWetAvalanche.py
\endverbatim

and you should see the following figure:

@image html "velocityPlot1D_phi0592.png" "Figure 10: Evolution of surface particle velocity. Experimental curves are extracted from Pailha et al.(2008)." width=400px
@image latex "velocityPlot1D_phi0592.png" "Figure 10: Evolution of surface particle velocity. Experimental curves are extracted from Pailha et al.(2008)."

@image html "pressurePlot1D_phi0592.png" "Figure 11 Evolution of excess of pore pressure with time. Experimental curves are extracted from Pailha et al.(2008)." width=400px
@image latex "pressurePlot1D_phi0592.png" "Figure 11: Evolution of excess of pore pressure with time. Experimental curves are extracted from Pailha et al.(2008)."

In order to illustrate the dilatant effects and the pore pressure feedback mechanism of the avalanche we run the python script *plot_tuto1DWetAvalancheVerticalProfiles.py*.
The resulting figure is depicted below. We observe the evolution of
the volume fraction, particle velocity and excess of pore pressure along the vertical axis.

@image html "1DWetAvalancheVerticalProfiles.png" "Figure 12: a) Evolution of volume fraction profile, b) particle velocity profile and c) excess of pore pressure along the vertical." width=1000px
@image latex "1DWetAvalancheVerticalProfiles.png" "Figure 12: a) Evolution of volume fraction profile, b) particle velocity profile and c) excess of pore pressure along the vertical."
=======
@image html "1DWetAvalancheVerticalProfiles.png" "Figure 11: a) Evolution of volume fraction profile, b) particle velocity profile and c) excess of pore pressure along the vertical." width=1000px
@image latex "1DWetAvalancheVerticalProfiles.png" "Figure 11: a) Evolution of volume fraction profile, b) particle velocity profile and c) excess of pore pressure along the vertical."

\section BoundaryLayer 1DBoundaryLayer: Single-phase turbulent boundary layer flow

In this test case, tturbulence model k-omega (Wilcox, 1988) is validated for a single-phase boundary layer flow over a smooth surface. The numerical results are compared with the DNS results of Moser et al. (1999).  A water column of dimensionless height \f$h=1\f$ is moving over a flat plate driven by a pressure gradient imposed along the x-axis. In this configuation, there are no sediments and the volumetric concentration of particles is set to alpha=0. A sketch of the 1D vertical computational domain is presented below:

@image html "Sketch1DBoundaryLayer.png" "Figure 13: Sketch of the numerical domain for the boudary layer shear flow configuration." width=400px
@image latex "Sketch1DBoundaryLayer.png" "Figure 13: Sketch of the numerical domain for the boudary layer shear flow configuration"


This tutorial is distributed with sedFoam under the folder sedFoamDirectory/tutorials/1DBoundaryLayer.

The domain is divided in 64 elements, with a cell expansion ratio of 1.026 along the vertical direction (the ratio between the first cell and the last cell is equal to 10). For such mesh the normalized distance to the wall from the first cell is \f$z^+=z u_\tau/\nu=1\f$ with \f$u_\tau\f$ the bottom friction velocity and \f$\nu\f$ the fluid viscosity.

The physical properties are chosen to obtain a dimensionless solution with \f$\rho=1\f$, \f$\nu=1/Re=7.2727\times10^{-5}\f$. The parameters are set in the file constant/transportProperties and ar given as follows:
\verbatim
// * * * * * * * * * * * * sediment properties * * * * * * * * * * * * //
phasea
{
    rho             rho [ 1 -3 0 0 0 ] 1;
    nu              nu [ 0 2 -1 0 0 ] 0e0;
    d               d [ 0 1 0 0 0 0 0 ] 1.e-7;
    sF              sF   [ 0 0  0 0 0 0 0 ] 1;
    hExp            hExp [ 0 0  0 0 0 0 0 ] 2.65;
}

phaseb
{
    rho             rho [ 1 -3 0 0 0 ] 1;
    nu              nu [ 0 2 -1 0 0 ] 7.2727e-5;
    d               d [ 0 1 0 0 0 0 0 ] 3.e-3;
    sF              sF   [ 0 0  0 0 0 0 0 ] 0.5;
    hExp            hExp [ 0 0  0 0 0 0 0 ] 2.65;
}
    d [ 0 1 0 0 0 0 0 ] 1;
}
//*********************************************************************** //
\endverbatim

The boundary Reynolds number based on the friction velocity in Moser et al. (1999) is, \f$Re_\tau=u_\tau h^f/\nu=590\f$. In sedFoam the flow is driven by a pressure gradient \f$\partial P/\partial x\f$ acting as a source term in the momentum equations. The pressure gradient is calculated by integrating the fluid momentum equation along th wall-normal direction sas follows:
\f[
 \dfrac{\partial P}{\partial x} = \dfrac{\rho u_\tau^2}{h}
\f]
and written in the file *constant/forceProperties* using the keyword *gradPMEAN*.

\subsection oneBLBC Boundary conditions

The inlet and outlet boundaries are set to cyclic while the front and back boundaries are set to empty. The latter boundary condition means that the y-components are not considered by the solver (i.e. 2 velocity components only). At the top boundary, the pressure is fixed to zero and a zero gradient (\*i.e* Neumann boundary condition) is imposed on all the other quantities. At the wall, the velocity is set to zero, a zeroGradient condition is imposed for the pressure and a wall function is imposed for the TKE dissipation.

The wall function is prescribing the value of TKE dissipation \f$\omega\f$ at the wall to follow the analytical solution from Wilcox (1988). In this tutorial, a rough wall function is used prescribing the value of \f$\omega\f$ at the wall following:
\f[
 \omega_{wall} = S_r\frac{u_\tau^2}{\nu}
\f]
with \f$S_r\f$ a tuning parameter taking into account bed roughness \f$k_s\f$ as follows:
\f[
 S_r=\left\{
\begin{array}{r}
 \left(\dfrac{50}{k^+_s}\right)^2, k^+_s < 25 \\
 \dfrac{100}{k^+_s}, k^+_s \geq 25
\end{array}
 \right.
\f]


\subsection post1DBoundayLayer Post-processing using python


The SedFoam results are plotted using the python script *plot_tuto1DBoundayLayer.py* located in the folder *tutorials/Py*:


\verbatim
python plot_tuto1DBoundaryLayer.py
\endverbatim

and you should see the following figure:
@image html "resTuto1DBoundaryLayer.png" "Figure 14: Results of the 1DBoundayLayer flow configuration compared with DNS simulations from Moin et al. (1999)." width=800px
@image latex "resTuto1DBoundaryLayer.png" "Figure 14: Results of the 1DBoundayLayer flow configuration compared with DNS simulations from Moin et al. (1999)."


Moser, R. D., Kim, J., and Mansour, N. N. (1999). Direct numerical simulation of turbulent channel flow up to retau=590. Physics of Fluids, 11(4):943-945.
Wilcox, D. C. (2008). Formulation of the k-w turbulence model revisited. AIAA Journal, 46(11):2823–2838.

\section SheetFlow 1DSheetFlow: Turbulent sheet-flows

In this tutorial, the turbulent flow over a flat erodible bed drives sediment transport in the intense turbulent bedload tranpsort regime usually referred to as sheet-flow. The results are compared with experimental data from Revil-Baudard et al. (2015). Light-weight non-spherical PMMA particles of median diameter d=3 mm are used having a settling velocity in quiescent water of about \f$W_{fall}=0.059\f$ m/s. The averaged flow velocity is about U=0.52 m/s corresponding to a bed friction velocity of \f$u_*=0.05\f$ m/s and a dimensionless bed shear stress, the so-called Shields number \f$\theta\f$, equal to 0.44.


@image html "SheetFlowHiSpeedCam.jpg" "Figure 15: Image from sheet-flow experiments (Revil-Baudard et al, 2015).  " width=600px
@image latex "SheetFlowHiSpeedCam.jpg" "Figure 15: Image from sheet-flow experiments (Revil-Baudard et al, 2015)."

\subsection preprocSF Pre-processing

This tutorial is distributed with sedFoam under the folder *sedFoamDirectory/tutorials/1DSheetFlow*.

\paragraph meshgenSF Mesh generation

The numerical domain consists of a square of side length L = 0.00085 m in the x-y plane and of height h=0.17 m in the vertical direction z. The side length is chosen to ensure a unity cell aspect ratio. A uniform mesh of 1 by 1 by 400 cells will be used. The block structure is the same as for the Sedimentation test case and is shown in Figure 1.

The mesh is generated by running blockMesh from within the case directory:

\verbatim
blockMesh
\endverbatim

\paragraph BC_initiSF Boundary and initial conditions

The case is set up to start at time t = 0 s, again the initial field data are stored in a 0_org sub-directory of the case directory. The 0_org sub-directory contains several files:  alpha_a, alphaMinFriction, alphaPlastic, Ua, Ub, p_rbgh, muI, pa, pa_new, Theta, k, epsilon, omega and nut one for each of the solid phase volume fraction (alpha_a), velocities of solid and fluid phases (Ua and Ub), the reduced pressure (p_rbgh) fields whose initial values and boundary conditions must be set. No-slip boundary conditions are imposed at the bottom and zero gradient at the top for both phase velocities.



\paragraph PhysPropSF Physical properties

The transportProperties file for the 1DSheetFlow case is shown below:

\verbatim
phasea
{
    rho             rho [ 1 -3 0 0 0 ] 1190;
    nu              nu [ 0 2 -1 0 0 ] 0e0;
    d               d [ 0 1 0 0 0 0 0 ] 3.e-3;
    sF              sF   [ 0 0  0 0 0 0 0 ] 0.5;    // shape Factor to adjust settling velocity for non-spherical particles
    hExp            hExp [ 0 0  0 0 0 0 0 ] 2.65;  // hindrance exponent for drag: beta^(-hExp) (2.65 by default)
}

phaseb
{
    rho             rho [ 1 -3 0 0 0 ] 1000;
    nu              nu [ 0 2 -1 0 0 ] 1.e-6;
    d               d [ 0 1 0 0 0 0 0 ] 3.e-3;
    sF              sF   [ 0 0  0 0 0 0 0 ] 0.5;
    hExp            hExp [ 0 0  0 0 0 0 0 ] 2.65;
}
//*********************************************************************** //

transportModel  Newtonian;

nu              nu [ 0 2 -1 0 0 0 0 ] 1.e-6;

nuMax           nuMax [0 2 -1 0 0 0 0] 1e-1;      // viscosity limiter for the Frictional model (required for stability)

alphaSmall      alphaSmall [ 0 0 0 0 0 0 0 ] 1e-6;  // minimum volume fraction (phase a) for division by alpha

alphaAlpha      alphaAlpha [ 0 0 0 0 0 ] 0;         // surface tension

\endverbatim

The physical property of the particles (diameter and density) and of the fluid (density and kinematic viscosity) have been set to the experimental values from Revil-Baudard et al. (2015).

Revil-Baudard, T., Chauchat, J., Hurther, D., and Barraud, P.-A. (2015). In- vestigation of sheet-flow processes based on novel acoustic high-resolution velocity and concentration measurements. Journal of Fluid Mechanics, 767:1–30.

In the dictionary *interfacialProperties* file the drag model from GidaspowSchillerNaumann is used and the shape factor sF is taken to 0.5 to match the settling velocity of a single particle with the measured data (w_fall = 0.056 m/s).

In this tutorial, the kinetic theory is used for the granular stress model and the *kineticTheoryProperties* reads:
\verbatim
kineticTheory   on;

equilibrium     off;

limitProduction off;

e               e [ 0 0 0 0 0 0 0 ] 0.8;

alphaMax        alphaMax [ 0 0 0 0 0 0 0 ] 0.6;

DiluteCut       DiluteCut [ 0 0 0 0 0 0 0 ] 0.00000;

ttzero          ttzero [ 0 0 1 0 0 0 0 ] 0;

ttone          ttone [ 0 0 1 0 0 0 0 ] 0;

MaxTheta       MaxTheta [ 0 2 -2 0 0 0 0 ] 0.5;

phi             phi [ 0 0 0 0 0 0 0 ] 32.0;

psi             psi [ 0 0 0 0 0 0 0 ] 0.0;

KineticJ1      KineticJ1 [ 0 0 0 0 0 0 0 ] 1; //turn off the viscous dissipation

KineticJ2       KineticJ2 [ 0 0 0 0 0 0 0] 0;

KineticJ3       KineticJ3 [ 0 0 0 0 0 0 0] 0;

viscosityModel  Syamlal;

conductivityModel Syamlal;

granularPressureModel Lun;

frictionalStressModel SrivastavaSundaresan;

radialModel     CarnahanStarling;
\endverbatim

The turbulence model is set to kEpsilon in *turbulenceProperties*:

\verbatim

simulationType  RAS;

RAS{
    RASModel        twophasekEpsilon;

turbulence      on;
printCoeffs     on;
}

\endverbatim

\paragraph Disc_solvSF1 Discretisation and linear-solver settings

The numerical schemes and the solvers are the same as in the 1DSedim case except that numerical schemes for the turbulent quantities (k,\f$\varepsilon\f$,\f$\omega\f$) have been added:

\verbatim

ddtSchemes
{
    default         Euler implicit;
}

gradSchemes
{
    default         Gauss linear;
}

divSchemes
{
    default         none;
// alphaEqn
    div(phi,alpha)  Gauss limitedLinear01 1;
    div(phir,alpha) Gauss limitedLinear01 1;
// UEqn
    div(phia,Ua)    Gauss limitedLinearV 1;
    div(phib,Ub)    Gauss limitedLinearV 1;
    div(phiRa,Ua)   Gauss limitedLinear 1;
    div(phiRb,Ub)   Gauss limitedLinear 1;
// pEqn
    div(alpha,nu)   Gauss linear;
// k and EpsilonEqn
    div(phib,k)     Gauss limitedLinear 1;
    div(phib,epsilon) Gauss limitedLinear 1;
    div(phib,omega) Gauss limitedLinear 1;
// ThetaEqn
    div(phi,Theta)  Gauss limitedLinear 1;
// alphaPlastic
    div(phia,alphaPlastic)  Gauss limitedLinear01 1;
// pa
    div(phia,pa_new_value)  Gauss limitedLinear 1;
}

laplacianSchemes
{
    default         none;
// UEqn
    laplacian(nuEffa,Ua) Gauss linear corrected;
    laplacian(nuEffb,Ub) Gauss linear corrected;
    laplacian(nuFra,Ua)  Gauss linear corrected;
// pEqn
    laplacian((rho*(1|A(U))),p_rbgh) Gauss linear corrected;
// k and EpsilonEqn
    laplacian(DkEff,k) Gauss linear corrected;
    laplacian(DkEff,beta) Gauss linear corrected;
    laplacian(DepsilonEff,epsilon) Gauss linear corrected;
    laplacian(DepsilonEff,beta) Gauss linear corrected;
    laplacian(DomegaEff,omega) Gauss linear corrected;
//ThetaEqn
    laplacian(kappa,Theta) Gauss linear corrected;
    laplacian(kappa2,alpha) Gauss linear corrected;
}

interpolationSchemes
{
    default  linear;
}

snGradSchemes
{
    default         corrected;
}

fluxRequired
{
    default         no;
    p_rbgh               ;
}
\endverbatim

\paragraph control_sedFoamSF Control

The system/controlDict file is modified compared with the laminar bed load test case, the time step is reduced to \f$ 2.10^{-5}\f$ s and the endTime is reduced to 150 s that is enough for the steady state to be reached.

\verbatim
application     sedFoam;

startFrom      latestTime;

startTime       0;

stopAt          endTime;

endTime         150;

deltaT          2e-4;

writeControl    adjustableRunTime;

writeInterval   10;

purgeWrite      0;

writeFormat     ascii;

writePrecision  6;

writeCompression uncompressed;

timeFormat      general;

timePrecision   6;

runTimeModifiable on;

adjustTimeStep  yes;

maxCo           0.1;

maxAlphaCo      0.1;

maxDeltaT       5e-4;

\endverbatim

\subsection postSF Post-processing using python

You just have to run the python script *plot_tuto1DSheetFlow.py* located in the folder *tutorials/Py*:

\verbatim
python plot_tuto1DSheetFlow.py
\endverbatim

and you should see the following figure:

@image html "res1_tuto3.png" "Figure 16: Comparison of two-phase numerical results with experiments of Revil-Baudard et al. (2015) in terms of velocity profiles, volume fraction, Reynolds shear stress and TKE/granular temperature using the kinetoc theory with the k-epsilon turbulence model.  " width=800px
@image latex "res1_tuto3.png" "Figure 16: Comparison of two-phase numerical results with experiments of Revil-Baudard et al. (2015) in terms of velocity profiles, volume fraction, Reynolds shear stress and TKE/granular temperature using the kinetoc theory with the k-epsilon turbulence model."


*/
