<link rel="icon" type="image/png" href="SedFOAM1.png" />
<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="icon" type="image/png" href="SedFOAM1.png" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="SedFOAM1.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
 <td width="100%" align="center" valign="bottom"><a href="http://www.twitter.com/sedfoam"><img src="twitter.png" alt="Follow SedFOAM on Twitter" border="0" width="16" height="16"/></a>
      <a href="http://github.com/sedfoam/sedfoam"><img src="github.png" alt="SedFOAM on github" border="0" width="16" height="16"/></a>
  </td>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="http://github.com/sedfoam/sedfoam"><span>Download</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tutorials.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tutorials </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Sedim_testcase">Pure sedimentation: 1DSedim</a><ul><li class="level2"><a href="#preproc">Pre-processing</a><ul><li class="level3"><a href="#meshgen">Mesh generation</a></li>
<li class="level3"><a href="#BC_init">Boundary and initial conditions</a></li>
<li class="level3"><a href="#PhysProp">Physical properties</a></li>
<li class="level3"><a href="#control_sedFoam">Control</a></li>
<li class="level3"><a href="#Disc_solv">Discretisation and linear-solver settings</a></li>
</ul>
</li>
<li class="level2"><a href="#viewmesh">Viewing the mesh</a></li>
<li class="level2"><a href="#run_sedFoam">Running sedFoam_rbgh</a></li>
<li class="level2"><a href="#post">Post-processing</a><ul><li class="level3"><a href="#postparaview">Using paraview</a></li>
<li class="level3"><a href="#postfluidfoam">Using fluidfoam</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#BedLoadCLB">Laminar bedLoad: 1DBedload</a><ul><li class="level2"><a href="#preprocBL">Pre-processing</a><ul><li class="level3"><a href="#meshgenBL">Mesh generation</a></li>
<li class="level3"><a href="#BC_initiBL">Boundary and initial conditions</a></li>
<li class="level3"><a href="#PhysPropBL">Physical properties</a></li>
<li class="level3"><a href="#Disc_solvBL">Discretisation and linear-solver settings</a></li>
<li class="level3"><a href="#control_sedFoamBL">Control</a></li>
</ul>
</li>
<li class="level2"><a href="#postBL">Post-processing using python</a></li>
<li class="level2"><a href="#ExtensionBL">Extension to the Mu(Iv) rheology</a></li>
</ul>
</li>
<li class="level1"><a href="#SheetFlow">Turbulent sheet-flows: 1DSheetFlow</a><ul><li class="level2"><a href="#preprocSF">Pre-processing</a><ul><li class="level3"><a href="#meshgenSF">Mesh generation</a></li>
<li class="level3"><a href="#BC_initiSF">Boundary and initial conditions</a></li>
<li class="level3"><a href="#PhysPropSF">Physical properties</a></li>
<li class="level3"><a href="#Disc_solvSF1">Discretisation and linear-solver settings</a></li>
<li class="level3"><a href="#control_sedFoamSF">Control</a></li>
</ul>
</li>
<li class="level2"><a href="#postSF">Post-processing using python</a></li>
</ul>
</li>
<li class="level1"><a href="#dryavalanche">Dry granular avalanche: 1DAvalancheMuI</a><ul><li class="level2"><a href="#preprocAva">Pre-processing</a><ul><li class="level3"><a href="#meshgenAva">Mesh generation</a></li>
<li class="level3"><a href="#BC_initiAva">Boundary and initial conditions</a></li>
<li class="level3"><a href="#PhysPropAva">Physical properties</a></li>
</ul>
</li>
<li class="level2"><a href="#postSF2">Post-processing using python</a></li>
</ul>
</li>
<li class="level1"><a href="#Scour">Scour downstream of an apron: 2DScourApron</a><ul><li class="level2"><a href="#preprocSA">Pre-processing</a><ul><li class="level3"><a href="#meshgenSA">Mesh generation</a></li>
<li class="level3"><a href="#BC_initiSA">Boundary and initial conditions</a></li>
<li class="level3"><a href="#PhysPropSA">Physical properties</a></li>
<li class="level3"><a href="#Disc_solvSF2">Discretisation and linear-solver settings</a></li>
<li class="level3"><a href="#control_sedFoamSF2">Control</a></li>
<li class="level3"><a href="#lauch_SA">Computation launching</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#appendix">Variables list</a></li>
</ul>
</div>
<div class="textblock"><p>In this chapter we shall describe in detail the process of setup, simulation and post-processing for some SedFOAM test cases All the tutorial cases are in the tutorial directory. The text herein is highly inspired from the OpenFOAM user-guide for the cavity turorial available at <a href="http://cfd.direct/openfoam/user-guide/cavity/">http://cfd.direct/openfoam/user-guide/cavity/</a> but is adapted to the specificity of sedFoam.</p>
<h1><a class="anchor" id="Sedim_testcase"></a>
Pure sedimentation: 1DSedim</h1>
<p>This tutorial will describe how to pre-process, run and post-process a case corresponding to a pure sedimentatiton problem in a one-dimensional configuration using the two-phase flow equations. The geometry is shown in Figure 1 in which bottom boundary is a wall and the top boundary is an open boundary. Initially, the flow is at rest and will be solved on a uniform mesh using the sedFoam solver for laminar, isothermal, incompressible two-phase flow. The numerical results are compared with experiments to validate the model in terms of settling curves, time evolution of concentration interface, and concentration profiles.</p>
<h2><a class="anchor" id="preproc"></a>
Pre-processing</h2>
<p>Like in OpenFOAM, cases are setup by editing case files using a text editor such as atome, vscode/vscodium, emacs, vi, gedit, nedit, etc. The I/O uses a dictionary format with keywords. A case involves data for mesh, fields, properties, control parameters, etc that are stored in a set of files within a case directory rather than in a single case file. The case directory is given a suitably descriptive name. This tutorial consists of a set of cases located in the sedFoam distribution under the folder sedFoamDirectory/tutorials/1DSedim.</p>
<h3><a class="anchor" id="meshgen"></a>
Mesh generation</h3>
<p>OpenFOAM always operates in a 3 dimensional Cartesian coordinate system and all geometries are generated in 3 dimensions. OpenFOAM solves the case in 3 dimensions by default but can be instructed to solve in 2 dimensions by specifying a ‘special’ empty boundary condition on boundaries normal to the (3rd) dimension for which no solution is required. In 2 dimensions, the directions x and y are always chosen even if the mesh is given in the x-z plane.</p>
<p>The sedimentation domain consists of a square of side length L = 0.006 m in the x–y plane and of height h=0.06 m in the vertical direction z. The side lentgh is chosen to ensure a unity cell aspect ratio. A uniform mesh of 1 by 1 by 100 cells will be used. The block structure is shown in Figure 1.</p>
<div class="image">
<img src="Skecth1DSedim.png" alt="Skecth1DSedim.png"/>
<div class="caption">
Figure 1: Block structure of the mesh for the 1D sedimentation problem. </div></div>
 <p>The mesh generator supplied with OpenFOAM, blockMesh, generates meshes from a description specified in an input dictionary, blockMeshDict located in the constant/polyMesh directory for a given case. The blockMeshDict entries for this case are as follows:</p>
<pre class="fragment">/*--------------------------------*- C++ -*----------------------------------*\
| =========                 |                                                 |
| \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox           |
|  \\    /   O peration     | Version:  1.7.1                                 |
|   \\  /    A nd           | Web:      www.OpenFOAM.com                      |
|    \\/     M anipulation  |                                                 |
\*---------------------------------------------------------------------------*/
FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      blockMeshDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

convertToMeters 0.06;

vertices        
(
    (-0.005 0   0.005) //0
    ( 0.005 0   0.005) //1
    ( 0.005 1.  0.005) //2
    (-0.005 1.  0.005) //3
    (-0.005 0  -0.005) //4
    ( 0.005 0  -0.005) //5
    ( 0.005 1. -0.005) //6
    (-0.005 1. -0.005) //7
);

blocks          
(
    hex (0 1 5 4 3 2 6 7) (1 1 200) simpleGrading (1 1 1)
);

edges           
(
);

boundary         
(
    inlet 
    {
     type   cyclic;
     neighbourPatch outlet;
     faces ((0 3 7 4));
    }
    outlet
    {
     type   cyclic;
     neighbourPatch  inlet;
     faces  ((1 5 6 2));
    }
    top
    { 
     type wall;
        faces ((7 6 2 3));
    }
    bottom 
    {
     type wall;
     faces ((0 4 5 1)); 
    }
    frontAndBackPlanes
    {
    type empty;
    faces (
           (0 1 2 3)
           (4 7 6 5)
          );
    }
);

mergePatchPairs
(
);

// ************************************************************************* //</pre><p>The file first contains header information in the form of a banner (lines 1-7), then file information contained in a FoamFile sub-dictionary, delimited by curly braces ({…}).</p>
<p>The file first specifies coordinates of the block vertices; it then defines the blocks (here, only 1) from the vertex labels and the number of cells within it; and finally, it defines the boundary patches. The user is encouraged to consult the offical documentation <a href="http://cfd.direct/openfoam/user-guide/blockMesh/#x25-1750005.3">here</a> to understand the meaning of the entries in the <em>blockMeshDict</em> file.</p>
<p>The mesh is generated by running blockMesh on this blockMeshDict file. From within the case directory, this is done, simply by typing in the terminal:</p>
<pre class="fragment">blockMesh
</pre><p>The running status of blockMesh is reported in the terminal window. Any mistakes in the blockMeshDict file are picked up by blockMesh and the resulting error message directs the user to the line in the file where the problem occurred. There should be no error messages at this stage.</p>
<h3><a class="anchor" id="BC_init"></a>
Boundary and initial conditions</h3>
<p>Once the mesh generation is complete, the user can look at this initial fields set up for this case. The case is set up to start at time t = 0 s, so the initial field data is stored in a 0_org sub-directory of the 1DSedim directory. The 0_org sub-directory contains several files: alpha_a, Ua, Ub, p_rbgh, muI, pa, Theta, one for each of the solid phase volume fraction (alpha_a), velocities of solid and fluid phases (Ua and Ub), the reduced pressure (p_rbgh) fields whose initial values and boundary conditions must be set. Let us examine file Ua:</p>
<pre class="fragment">dimensions      [0 1 -1 0 0 0 0];

internalField   uniform (0 0 0);

boundaryField
{
    inlet
    {
        type            cyclic;
    }
    outlet
    {
        type            cyclic;
    }
    top
    {
        type            zeroGradient;
    }
    bottom
    {
        type            fixedValue;
        value           uniform (0 0 0);
    }
    frontAndBackPlanes
    {
        type            empty;
    }
}</pre><p>There are 3 principal entries in field data files:</p>
<p>dimensions specifies the dimensions of the field, here velocity, i.e. m s <img class="formulaInl" alt="$^{-1}$" src="form_0.png"/> ; internalField the internal field data which are set to be uniform; boundaryField the boundary field data that includes boundary conditions and data for all the boundary patches.</p>
<p>For this case 1DSedim, the boundary consists of cyclic boundaries at the inlet and outlet (left and right boundaries) and walls at the top and bottom boundaries, the top boundary is zeroGradient whereas the bottom boundary is a no-slip boundary conditions i.e zero velocity at the wall. The frontAndBack patch represents the front and back planes of the 2D case and therefore must be set as empty.</p>
<p>The user can similarly examine the fluid phase velocity field in the 0_org/Ub file. The solid phase volume fraction has zeroGradient boundary conditions at the top and bottom boundaries whereas the pressure has fixedValue at the top boundary (equivalent to setting the atmospheric pressure) and a fixedFluxPressure at the bottom boundary. We shall explain below what this boundary condition means.</p>
<h3><a class="anchor" id="PhysProp"></a>
Physical properties</h3>
<p>The physical properties for the case are stored in dictionaries whose names are given the suffix …Properties, located in the Dictionaries directory tree. For a sedFoam case, there are 8 property files: transportProperties, interfacialProperties, ppProperties, granularRheologyProperties, kineticTheoryProperties, RASProperties twophaseRASProperties</p>
<p>In the transport property file, the physical properties of the solid and fluid phases are set, such as density, kinematic viscosity and particle diameter.</p>
<pre class="fragment">// * * * * * * * * * * * * sediment properties * * * * * * * * * * * * //
phasea
{   
    rho             rho [ 1 -3 0 0 0 ] 1050;
    nu              nu [ 0 2 -1 0 0 ] 1e-6;
    d               d [ 0 1 0 0 0 0 0 ] 290e-6;    
    hExp            hExp [ 0 0  0 0 0 0 0 ] 3.15;  // hindrance exponent for drag: beta^(-hExp) (2.65 by default)
}
// * * * * * * * * * * * * fluid properties * * * * * * * * * * * * //
phaseb
{   
    rho             rho [ 1 -3 0 0 0 ] 950;
    nu              nu [ 0 2 -1 0 0 ] 2.105e-05;
    d               d [ 0 1 0 0 0 0 0 ] 290e-6;
}
//*********************************************************************** //
transportModel  Newtonian;

nu              nu [ 0 2 -1 0 0 0 0 ] 2.105e-05;

nuMax           nuMax [0 2 -1 0 0 0 0] 1e-1;      // viscosity limiter for the Frictional model (required for stability)

alphaSmall      alphaSmall [ 0 0 0 0 0 0 0 ] 1e-6;  // minimum volume fraction (phase a) for division by alpha_a</pre><p>The hindrance function exponent of the Richardson-Zaki law can be tuned using the parameter hExp. This is important for this first test case which is in the laminar regime for the drag. The transportModel has to be prescribed when using turbulence model, it is present here for compatibility with the other test cases. The nuMax value is a viscosity limiter for the all the viscosities, it allows the user to control the numerical stability of the solver and will be discussed in the second test case. It is especially important as some shear stress terms are discretized explicitely and that the frictional viscosity can reach huge values. The alphaSmall value is used to regularise the division by alpha_a in the source code, the default value is set to <img class="formulaInl" alt="$ 10^{-6} $" src="form_1.png"/>.</p>
<p>The dictionary <em>interfacialProperties</em> allows to specify the drag model:</p>
<pre class="fragment">dragModela      GidaspowSchillerNaumann;

dragModelb      GidaspowSchillerNaumann;

dragPhase       a;
</pre><p>The model chosen here is GidaspowSchilerNaumann that corresponds to the drag force around a spherical particle corrected by a hindrance function ( <img class="formulaInl" alt="$ \beta^{-hExp}$" src="form_2.png"/>).</p>
<p>The dictionary <em>ppProperties</em> contains the informations concerning the permanent contact contribution to the solid phase pressure. In sedFoam, the model of Johnson and Jackson (1987) is used:</p>
<p><img class="formulaInl" alt="$ p_{ff} = Fr \frac{\left( \alpha - \alpha_{min}^{Friction} \right)^{\eta}}{\left(\alpha_{Max} - \alpha \right)^p} $" src="form_3.png"/></p>
<pre class="fragment">ppModel          JohnsonJackson;

alphaMax         alphaMax [ 0 0 0 0 0 0 0 ] 0.635;

alphaMinFriction alphaMinFriction [ 0 0 0 0 0 0 0 ] 0.57;

Fr               Fr [ 1 -1 -2 0 0 0 0 ] 5e-2;

eta0             eta0 [ 0 0 0 0 0 0 0 ] 3;

eta1             eta1 [ 0 0 0 0 0 0 0 ] 5;

packingLimiter  no;</pre><p>And the dictionary <em>granularRheologyProperties</em> controls the granular rheology part:</p>
<pre class="fragment">granularRheology   on;

alphaMaxG       alphaMaxG [ 0 0 0 0 0 0 0 ] 0.6;

mus             mus  [ 0 0 0 0 0 0 0 ] 0.24;

mu2             mu2  [ 0 0 0 0 0 0 0 ] 0.39;

I0              I0  [ 0 0 0 0 0 0 0 ] 0.01;

Bphi            Bphi [ 0 0 0 0 0 0 0 ] 1.;

n               n [ 0 0 0 0 0 0 0 ] 1.;

Dsmall          Dsmall [ 0 0 -1 0 0 0 0 ] 1e-4;

relaxPa         relaxPa [ 0 0 0 0 0 0 0 ] 1;

FrictionModel   Coulomb;

PPressureModel  none;

FluidViscosityModel Einstein;</pre><p>On the first line the switch granularRheology allows to turn on and off this module. The keywords FrictionModel, PPressureModel and FluidViscosityModel allow to choose the friction model, the shear induced particle pressure model and the effective viscosity model (see <a class="el" href="inputs.html">Input description</a> for details).</p>
<p>For the present case the granularRheology is set to Coulomb and the FluidViscosityModel is used for the effective viscosity model and a Einstein model is used. All the details concerning the different models can be found in the Geophysical Model Development paper on sedFoam.</p>
<p>The remaining dictionaries are not used for this tutorial and will not be detailled here. Their content will be explained in the next tutorials when they are used.</p>
<h3><a class="anchor" id="control_sedFoam"></a>
Control</h3>
<p>Input data relating to the control of time and reading and writing of the solution data are read in from the controlDict dictionary. The user should view this file; as a case control file, it is located in the system directory.</p>
<p>The start/stop times and the time step for the run must be set. OpenFOAM offers great flexibility with time control which is described in full in section 4.3. In this tutorial we wish to start the run at time t = 0 which means that OpenFOAM needs to read field data from a directory named 0. Therefore we set the startFrom keyword to startTime and then specify the startTime keyword to be 0.</p>
<p>As the simulation progresses we wish to write results at certain intervals of time that we can later view with a post-processing package. The writeControl keyword presents several options for setting the time at which the results are written; here we select the adjustableRunTime option which specifies that results are written every writeInterval seconds of simulated time, adjusting the time steps to coincide with the writeInterval if necessary and the time step is automatically adjusted using adjustTimeStep = on. The time step controled using different criteria on Courant numbers based on the maximum velocity, the relative velocity ( <img class="formulaInl" alt="$ U_r=U_b-U_a $" src="form_4.png"/>) and the interfacial courant number. The maximum values of the Courant numbers (maxCo and maxAlphaCo) are set in the controlDict and the maximum value of the time step is controlled by the parameter maxDeltaT.</p>
<p>OpenFOAM creates a new directory named after the current time, e.g. 20 s, on each occasion that it writes a set of data, as discussed in full in section 4.1. In the icoFoam solver, it writes out the results for each field, U and p, into the time directories. For this case, the entries in the controlDict are shown below:</p>
<pre class="fragment">application     sedFoam;

startFrom       startTime;

startTime       0;

stopAt          endTime;

endTime         1800;

deltaT          1e-5;

writeControl    adjustableRunTime;

writeInterval   20;

purgeWrite      0;

writeFormat     ascii;

writePrecision  6;

timeFormat      general;

timePrecision   6;

runTimeModifiable on;

adjustTimeStep  on;

maxCo           0.3;

maxAlphaCo      0.3;

maxDeltaT       2e-1;
</pre><h3><a class="anchor" id="Disc_solv"></a>
Discretisation and linear-solver settings</h3>
<p>The numerical schemes and linear solvers are set in the system/fvSchemes and system/fvSolution files respectively.</p>
<p>Concerning the numerical schemes, the time discretisation is a Euler implicit scheme, the divergence terms are of Gauss limitedLinear type (2nd order centered schemes with a Sweby limiter) and the laplacian scheme is Gauss linear corrected for all terms. The fvScheme file is shown below:</p>
<pre class="fragment">ddtSchemes
{
    default         Euler implicit;
}

gradSchemes
{
        default         Gauss linear;
}

divSchemes
{
    default         none;
// alphaEqn
    div(phi,alpha)  Gauss upwind;//limitedLinear01 1;
    div(phir,alpha) Gauss upwind;//limitedLinear01 1;
// UEqn
    div(phia,Ua)    Gauss limitedLinearV 1;
    div(phib,Ub)    Gauss limitedLinearV 1;
    div(phiRa,Ua)   Gauss limitedLinear 1;
    div(phiRb,Ub)   Gauss limitedLinear 1;
// pEqn
    div(alpha,nu)   Gauss linear;
// alphaPlastic
    div(phia,alphaPlastic)   Gauss upwind;
// pa
    div(phia,pa_new_value)   Gauss upwind;
}

laplacianSchemes
{
    default         none;
// UEqn
    laplacian(nuEffa,Ua) Gauss linear corrected;
    laplacian(nuEffb,Ub) Gauss linear corrected;
    laplacian(nuFra,Ua)  Gauss linear corrected;
// pEqn
    laplacian((rho*(1|A(U))),p_rbgh) Gauss linear corrected;
}

interpolationSchemes
{
    default  linear;
}

snGradSchemes
{
    default         corrected;
}

fluxRequired
{
    default         no;
    p_rbgh               ;
}
</pre><p>In the system/fvSolution file, the user can specify the linear solver he/she wants to use for each equation and the tolerance for the resolution. The user can also control the number of corrector steps and non-orthogonal correctors (useles for cartesian grids) for the PIMPLE algorithm. In the present case, a single PIMPLE corrector is enough the residual of the pressure equation is shown to converge well. The fvSolution file is reproduced below:</p>
<pre class="fragment">solvers
{
    p_rbgh
    {
        solver          GAMG;
        tolerance       1e-9;
        relTol          0.0001;
        smoother        DIC;
        nPreSweeps      0;
        nPostSweeps     2;
        nFinestSweeps   2;
        cacheAgglomeration true;
        nCellsInCoarsestLevel 10;
        agglomerator    faceAreaPair;
        mergeLevels     1;
    }

    p_rbghFinal
    {
        $p_rbgh;
        tolerance       1e-9;
        relTol          0;
    }
    "(alpha_a|Ua|Ub|pa_new_value)"
    {
        solver          PBiCG;
        preconditioner  DILU;
        tolerance       1e-9;
        relTol          0;
    }
    "(alpha_aFinal|UaFinal|UbFinal|pa_newFinal)"
    {
        solver          PBiCG;
        preconditioner  DILU;
        tolerance       1e-9;
        relTol          0;
    }
}

PIMPLE
{
    momentumPredictor 0;
    nOuterCorrectors  1;
    nCorrectors     1;
    nNonOrthogonalCorrectors 0;
    correctAlpha    0;
    nAlphaCorr      1;
    pRefCell        0;
    pRefValue       0;
}


relaxationFactors
{
    fields
    {
        p_rbgh               1.;
        p_rbghFinal          1;
    }
    equations
    {
        "Ua|Ub|k|omega"             1.;
        "(Ua|Ub|k|omega)Final"      1;
    }

}
</pre> <h2><a class="anchor" id="viewmesh"></a>
Viewing the mesh</h2>
<h2><a class="anchor" id="run_sedFoam"></a>
Running sedFoam_rbgh</h2>
<p>The easiest way to run the test case is to run the shell script:</p>
<pre class="fragment"># Create the mesh
blockMesh

# create the intial time folder
cp -r 0_org 0

# Initialize the alpha_a field
funkySetFields -time 0

# Write the mesh in folder 0/
writeCellCentres -time 0

# Run sedFoam_rbgh
sedFoam_rbgh &gt; log&amp;
</pre><p>The script is self documented, the blockMesh command has already been introduced. The initial condition stored in the 0_org folder is first copied to the zero (0) folder. The command funkySetFields (require swak4foam library) allows to set the initial solid phase volume fraction profile following an hyperbolic tangent profile described in the dictionnary <em>system/funkySetFieldsDict</em> as folows:</p>
<pre class="fragment">expressions
 (      
        alpha1
        {
                field alpha_a;
                expression "0.5*0.5*(1.0+tanh((pos().y-0.054)/(0.0490-pos().y)*10.0))";
                keepPatches 1;
        }       
        alpha2
        {
                field alpha_a;
                expression "0.5";
                condition "pos().y &lt; 0.049";
                keepPatches 1;
        }
 );
</pre><p>The command writeCellCentres write the coordinates of the cell centers in the 0 folder for future postprocessing using python.</p>
<p>The code is run using the command sedFoam_rbgh in the terminal. The "&gt; log &amp;" allows to run the code in batch and write the output in the file log. The run can be monitored using the command</p>
<pre class="fragment">tail -100 log
</pre><p>comment: Shall we replace the batch execution by an interactive run to avoid beginners to run multiple times the code without knowing how to kill the process.</p>
<h2><a class="anchor" id="post"></a>
Post-processing</h2>
<h3><a class="anchor" id="postparaview"></a>
Using paraview</h3>
<p>The reader is reffered to the OpenFOAM tutorial for the lid driven cavity for the basic manipulation on paraview such as viewing loading the data or viewing the mesh (<a href="http://cfd.direct/openfoam/user-guide/cavity/">http://cfd.direct/openfoam/user-guide/cavity/</a>).</p>
<h3><a class="anchor" id="postfluidfoam"></a>
Using fluidfoam</h3>
<p>The postprocessing using python requires the installation of the package fluidfoam available at hg clone <a href="https://bitbucket.org/sedfoam/fluidfoam">https://bitbucket.org/sedfoam/fluidfoam</a>. If the pacakage is installed properly with all the dependencies, you just have to run the python script <em>plot_tutoSedimentation.py</em> located in the folder <em>tutorials/Py</em>:</p>
<pre class="fragment">python plot_tutoSedimentation.py
</pre><p>and you should see the following figures:</p>
<div class="image">
<img src="res1_tuto1.png" alt="res1_tuto1.png"/>
<div class="caption">
Figure 2: Comparison of two-phase numerical results with experiments of Pham Van Bang et al. (2006) for the settling curves: time evolution of the lower and upper interface positions (circles: experiments ; lines: model). </div></div>
  <div class="image">
<img src="res2_tuto1.png" alt="res2_tuto1.png"/>
<div class="caption">
Figure 3: Comparison of two-phase numerical results with experiments of Pham Van Bang et al. (2006) for solid phase volume fraction profiles (dashed blue lines: experiment ; solid red lines: model).</div></div>
 <h1><a class="anchor" id="BedLoadCLB"></a>
Laminar bedLoad: 1DBedload</h1>
<p>We consider a flat particle bed submitted to a Poiseuille flow driven by a pressure gradient in a horizontal channel. This situation has been studied experimentally, analytically and numerically by Ouriemi et al. (2009) and Aussillous et al. (2013). The goal of this tutorial is to illustrate the ability of sedFoam to reproduce dense granular flows using the dense granular flow rheology <img class="formulaInl" alt="$\mu(Iv)$" src="form_5.png"/>. For this purpose sedFoam will be first compared with the analytical solution from Aussillous et al. (2013) using a Coulomb friction rheology. In a second part, the results obtained using the <img class="formulaInl" alt="$\mu(Iv)$" src="form_5.png"/> rheology are compared with a simple 1D numerical model.</p>
<h2><a class="anchor" id="preprocBL"></a>
Pre-processing</h2>
<p>This tutorial is distributed with sedFoam3.0 under the folder sedFoamDirectory/tutorials/1DBedLoad.</p>
<h3><a class="anchor" id="meshgenBL"></a>
Mesh generation</h3>
<p>The numerical domain consists of a square of side length L = 0.0065 m in the x-y plane and of height h=0.065 m in the vertical direction z. The side lentgh is chosen to ensure a unity cell aspect ratio. A uniform mesh of 1 by 1 by 200 cells will be used. The block structure is the same as for the Sedimentation test case and is shown in Figure 1.</p>
<p>The mesh is generated by running blockMesh from within the case directory:</p>
<pre class="fragment">blockMesh
</pre><h3><a class="anchor" id="BC_initiBL"></a>
Boundary and initial conditions</h3>
<p>The case is set up to start at time t = 0 s, again the initial field data are stored in a 0_org sub-directory of the case directory. The 0_org sub-directory contains several files: alpha_a, alphaMinFriction, alphaPlastic, Ua, Ub, p_rbgh, muI, pa, pa_new, Theta, one for each of the solid phase volume fraction (alpha_a), velocities of solid and fluid phases (Ua and Ub), the reduced pressure (p_rbgh) fields whose initial values and boundary conditions must be set. Compared with the sedimentation test case, no-slip boundary conditions are imposed for both phase velocity at the top and bottom boundaries.</p>
<h3><a class="anchor" id="PhysPropBL"></a>
Physical properties</h3>
<p>The transportProperties file for the 1DBedload case is shown below:</p>
<pre class="fragment">// * * * * * * * * * * * * sediment properties * * * * * * * * * * * * //
phasea
{   
    rho             rho [ 1 -3 0 0 0 ] 1190;
    nu              nu [ 0 2 -1 0 0 ] 1e-6;
    d               d [ 0 1 0 0 0 0 0 ] 2.e-3;
}

phaseb
{   
    rho             rho [ 1 -3 0 0 0 ] 1070;
    nu              nu [ 0 2 -1 0 0 ] 2.52e-4;
    d               d [ 0 1 0 0 0 0 0 ] 2.e-3;
}
//*********************************************************************** //
transportModel  Newtonian;

nu              nu [ 0 2 -1 0 0 0 0 ] 2.52e-4;

nuMax           nuMax [0 2 -1 0 0 0 0] 1e1;      // viscosity limiter for the Frictional model (required for stability)

alphaSmall      alphaSmall [ 0 0 0 0 0 0 0 ] 1e-6;  // minimum volume fraction (phase a) for division by alpha_a</pre><p>The physical property of the particles (diameter and density) and of the fluid (density and kinematic viscosity) have been set to the experimental values from Aussillous et al. (2013).</p>
<p>In the dictionary <em>interfacialProperties</em> file the drag model from GidaspowShcillerNaumann has been kept, the influence of the drag model on this test case as the relative velocity between the fluid and the particles is negligible.</p>
<p>Compared with the sedimentation test case, the <em>granularRheologyProperties</em> is critical. The file is shown below:</p>
<pre class="fragment">granularRheology   on;

alphaMaxG       alphaMaxG [ 0 0 0 0 0 0 0 ] 0.6;

mus             mus  [ 0 0 0 0 0 0 0 ] 0.32;

mu2             mu2  [ 0 0 0 0 0 0 0 ] 0.94;

I0              I0  [ 0 0 0 0 0 0 0 ] 0.0077;

Bphi            Bphi [ 0 0 0 0 0 0 0 ] 1.0;

n               n [ 0 0 0 0 0 0 0 ] 2.5;

Dsmall          Dsmall [ 0 0 -1 0 0 0 0 ] 1e-4;

relaxPa         relaxPa [ 0 0 0 0 0 0 0 ] 1;

FrictionModel  Coulomb;
//FrictionModel  MuIv;

PPressureModel  none;

FluidViscosityModel  Einstein;
</pre><p>To compare with the analytical solution, the Coulomb Frictional model and the Einstein FluidViscosity model are used. No PPressureModel is specified meaning that the shear induced contribution to the solid phase pressure is not included i.e. the solid phase volume fraction profile must be sharp at the particle bed interface. The value of the rehological constants are chosen following Aussillous et al. (2013). The regularisation parameter Dsmall is taken as 1e-4, this is shown to be enough for this case but a sensitivity analysis could be performed in case of a too strong creeping flow in the particle bed.</p>
<h3><a class="anchor" id="Disc_solvBL"></a>
Discretisation and linear-solver settings</h3>
<p>The numerical schemes and the solvers are the same as in the 1DSedim case.</p>
<h3><a class="anchor" id="control_sedFoamBL"></a>
Control</h3>
<p>The system/controlDict file is modified compared with the sedimentation test case. The endTime is fixed to 350 s with an output every 50s with an adjustable time step limited to 5e-3 s.</p>
<pre class="fragment">application     sedFoam;

startFrom       latestTime;

startTime       0;

stopAt          endTime;

endTime         350;

deltaT          0.005;

writeControl    adjustableRunTime;

writeInterval   50.;

purgeWrite      0;

writeFormat     ascii;

writePrecision  6;

timeFormat      general;

timePrecision   6;

runTimeModifiable on;

adjustTimeStep  yes;

maxCo           0.1;

maxAlphaCo      0.1;

maxDeltaT       5e-03;
</pre><h2><a class="anchor" id="postBL"></a>
Post-processing using python</h2>
<p>You just have to run the python script <em>plot_tutoBedLoadCLB.py</em> located in the folder <em>tutorials/Py</em>:</p>
<pre class="fragment">python plot_tutoBedLoadCLB.py
</pre><p>and you should see the following figures:</p>
<div class="image">
<img src="res1_tuto2.png" alt="res1_tuto2.png"/>
<div class="caption">
Figure 4: Comparison of the streamwise velocity profiles for the flow of a Newtonian fluid over a granular bed having a Coulomb rheology between two infinite parallel planes obtained by numerical simulations with the analytical solution of Ouriemi et al. (2009) in terms of volume fraction (left panel), velocity profiles (middle panel) and particle pressure (right panel) profiles.</div></div>
  <h2><a class="anchor" id="ExtensionBL"></a>
Extension to the Mu(Iv) rheology</h2>
<p>The same configuration can be run using the <img class="formulaInl" alt="$\mu(Iv)$" src="form_5.png"/> rheology by modifying the system/controlDict file:</p>
<pre class="fragment">//startFrom       startTime;
startFrom       latestTime;

endTime     350;
</pre><p>and the constant/granularRheologyProperties file in the following way:</p>
<pre class="fragment">//FrictionModel  Coulomb;
FrictionModel  MuIv;
</pre><p>And run the code again using the command:</p>
<pre class="fragment">sedFoam_rbgh &gt; log2&amp;
</pre><p>At the end of the run, the run can be post-processed using the python script:</p>
<pre class="fragment">python plot_tutoBedLoadMUI.py
</pre><p>that results in the following figures:</p>
<div class="image">
<img src="res2_tuto2.png" alt="res2_tuto2.png"/>
<div class="caption">
Figure 5: Comparison of the streamwise velocity profiles for the flow of a Newtonian fluid over a granular bed having a mu(Iv) rheology between two infinite parallel planes obtained by numerical simulations with one-dimensional numerical solution presented in Aussillous et al. (2013) in terms of volume fraction (left panel), velocity profiles (middle panel) and particle pressure (right panel) profiles.</div></div>
  <h1><a class="anchor" id="SheetFlow"></a>
Turbulent sheet-flows: 1DSheetFlow</h1>
<p>In this tutorial, the turbulent flow over a flat erodible bed drives sediment transport in the intense turbulent bedload tranpsort regime usually referred to as sheet-flow. The results are compared with experimental data from Revil-Baudard et al. (2015). Light-weight non-spherical PMMA particles of median diameter d=3 mm are used having a settling velocity in quiescent water of about <img class="formulaInl" alt="$W_{fall}=0.059$" src="form_6.png"/> m/s. The averaged flow velocity is about U=0.52 m/s corresponding to a bed friction velocity of <img class="formulaInl" alt="$u_*=0.05$" src="form_7.png"/> m/s and a dimensionless bed shear stress, the so-called Shields number <img class="formulaInl" alt="$\theta$" src="form_8.png"/>, equal to 0.44.</p>
<h2><a class="anchor" id="preprocSF"></a>
Pre-processing</h2>
<p>This tutorial is distributed with sedFoam3.0 under the folder sedFoamDirectory/tutorials/1DSheetFlow.</p>
<h3><a class="anchor" id="meshgenSF"></a>
Mesh generation</h3>
<p>The numerical domain consists of a square of side length L = 0.00085 m in the x-y plane and of height h=0.17 m in the vertical direction z. The side lentgh is chosen to ensure a unity cell aspect ratio. A uniform mesh of 1 by 1 by 400 cells will be used. The block structure is the same as for the Sedimentation test case and is shown in Figure 1.</p>
<p>The mesh is generated by running blockMesh from within the case directory:</p>
<pre class="fragment">blockMesh
</pre><h3><a class="anchor" id="BC_initiSF"></a>
Boundary and initial conditions</h3>
<p>The case is set up to start at time t = 0 s, again the initial field data are stored in a 0_org sub-directory of the case directory. The 0_org sub-directory contains several files: alpha_a, alphaMinFriction, alphaPlastic, Ua, Ub, p_rbgh, muI, pa, pa_new, Theta, k, epsilon, omega and nut one for each of the solid phase volume fraction (alpha_a), velocities of solid and fluid phases (Ua and Ub), the reduced pressure (p_rbgh) fields whose initial values and boundary conditions must be set. No-slip boundary conditions are imposed at the bottom and zero gradient at the top for both phase velocities.</p>
<h3><a class="anchor" id="PhysPropSF"></a>
Physical properties</h3>
<p>The transportProperties file for the 1DBedload case is shown below:</p>
<pre class="fragment">phasea
{
    rho             rho [ 1 -3 0 0 0 ] 1190;
    nu              nu [ 0 2 -1 0 0 ] 0e0;
    d               d [ 0 1 0 0 0 0 0 ] 3.e-3;
    sF              sF   [ 0 0  0 0 0 0 0 ] 0.5;    // shape Factor to adjust settling velocity for non-spherical particles
    hExp            hExp [ 0 0  0 0 0 0 0 ] 2.65;  // hindrance exponent for drag: beta^(-hExp) (2.65 by default)
}

phaseb
{
    rho             rho [ 1 -3 0 0 0 ] 1000;
    nu              nu [ 0 2 -1 0 0 ] 1.e-6;
    d               d [ 0 1 0 0 0 0 0 ] 3.e-3;
    sF              sF   [ 0 0  0 0 0 0 0 ] 0.5;
    hExp            hExp [ 0 0  0 0 0 0 0 ] 2.65;
}
//*********************************************************************** //

transportModel  Newtonian;

nu              nu [ 0 2 -1 0 0 0 0 ] 1.e-6;

nuMax           nuMax [0 2 -1 0 0 0 0] 1e-1;      // viscosity limiter for the Frictional model (required for stability)

alphaSmall      alphaSmall [ 0 0 0 0 0 0 0 ] 1e-6;  // minimum volume fraction (phase a) for division by alpha 

alphaAlpha      alphaAlpha [ 0 0 0 0 0 ] 0;         // surface tension</pre><p>The physical property of the particles (diameter and density) and of the fluid (density and kinematic viscosity) have been set to the experimental values from Revil-Baudard et al. (2015).</p>
<p>In the dictionary <em>interfacialProperties</em> file the drag model from GidaspowSchillerNaumann is used and the shape factor sF is taken to 0.5 to match the settling velocity of a single particle with the measured data (w_fall = 0.056 m/s).</p>
<p>The <em>granularRheologyProperties</em> is similar to the one for the 1DBedLoadMuI case:</p>
<pre class="fragment">granularRheology   on;

alphaMaxG       alphaMaxG [ 0 0 0 0 0 0 0 ] 0.55;

mus             mus  [ 0 0 0 0 0 0 0 ] 0.52;

mu2             mu2  [ 0 0 0 0 0 0 0 ] 0.96;

I0              I0  [ 0 0 0 0 0 0 0 ] 0.6;

Bphi            Bphi [ 0 0 0 0 0 0 0 ] 0.66;

n               n [ 0 0 0 0 0 0 0 ] 2.5;

Dsmall          Dsmall [ 0 0 -1 0 0 0 0 ] 1e-6;

relaxPa         relaxPa [0 0 0 0 0 0 0] 1e-4;

FrictionModel  MuI;

PPressureModel MuI;

FluidViscosityModel  BoyerEtAl;</pre><p>For this case, the dense granular flow rheology <img class="formulaInl" alt="$\mu(I)$" src="form_9.png"/> is used and the parameters are set according to Chauchat (2017). The differences with the laminar bed load case is the use of the inertial regime of the <img class="formulaInl" alt="$\mu(I)$" src="form_9.png"/> rheology instead of the viscous one, the use of the shear induced pressure (PPressureModel) and the effective fluid viscosity model (FluidViscosityModel) from Boyer et al. (2011) is used.</p>
<h3><a class="anchor" id="Disc_solvSF1"></a>
Discretisation and linear-solver settings</h3>
<p>The numerical schemes and the solvers are the same as in the 1DSedim case except that numerical schemes for the turbulent quantities (k, <img class="formulaInl" alt="$\varepsilon$" src="form_10.png"/>, <img class="formulaInl" alt="$\omega$" src="form_11.png"/>) have been added:</p>
<pre class="fragment">ddtSchemes
{
    default         Euler implicit;
}

gradSchemes
{
    default         Gauss linear;
}

divSchemes
{
    default         none;
// alphaEqn
    div(phi,alpha)  Gauss limitedLinear01 1;
    div(phir,alpha) Gauss limitedLinear01 1;
// UEqn
    div(phia,Ua)    Gauss limitedLinearV 1;
    div(phib,Ub)    Gauss limitedLinearV 1;
    div(phiRa,Ua)   Gauss limitedLinear 1;
    div(phiRb,Ub)   Gauss limitedLinear 1;
// pEqn
    div(alpha,nu)   Gauss linear;
// k and EpsilonEqn
    div(phib,k)     Gauss limitedLinear 1;
    div(phib,epsilon) Gauss limitedLinear 1;
    div(phib,omega) Gauss limitedLinear 1;
// ThetaEqn
    div(phi,Theta)  Gauss limitedLinear 1;
// alphaPlastic
    div(phia,alphaPlastic)   Gauss upwind;
// pa
    div(phia,pa_new_value)   Gauss upwind;
}

laplacianSchemes
{
    default         none;
// UEqn
    laplacian(nuEffa,Ua) Gauss linear corrected;
    laplacian(nuEffb,Ub) Gauss linear corrected;
    laplacian(nuFra,Ua)  Gauss linear corrected;
// pEqn
    laplacian((rho*(1|A(U))),p_rbgh) Gauss linear corrected;
// k and EpsilonEqn 
    laplacian(DkEff,k) Gauss linear corrected;
    laplacian(DkEff,beta) Gauss linear corrected;
    laplacian(DepsilonEff,epsilon) Gauss linear corrected;
    laplacian(DepsilonEff,beta) Gauss linear corrected;
    laplacian(DomegaEff,omega) Gauss linear corrected;
//ThetaEqn
    laplacian(kappa,Theta) Gauss linear corrected;
}

interpolationSchemes
{
    default  linear;
}

snGradSchemes
{
    default         corrected;
}

fluxRequired
{
    default         no;
    p_rbgh               ;
}
</pre><h3><a class="anchor" id="control_sedFoamSF"></a>
Control</h3>
<p>The system/controlDict file is modified compared with the laminar bed load test case, the time step is reduced to <img class="formulaInl" alt="$ 2.10^{-5}$" src="form_12.png"/> s and the endTime is reduced to 150 s that is enough for the steady state to be reached.</p>
<pre class="fragment">application     sedFoam;

startFrom      latestTime;

startTime       0;

stopAt          endTime;

endTime         150;

deltaT          2e-5;

writeControl    adjustableRunTime;

writeInterval   10;

purgeWrite      0;

writeFormat     ascii;

writePrecision  6;

writeCompression uncompressed;

timeFormat      general;

timePrecision   6;

runTimeModifiable on;

adjustTimeStep  yes;

maxCo           0.03;

maxAlphaCo      0.03;

maxDeltaT       2e-5;</pre><h2><a class="anchor" id="postSF"></a>
Post-processing using python</h2>
<p>You just have to run the python script <em>plot_tutoSheetFlow.py</em> located in the folder <em>tutorials/Py</em>:</p>
<pre class="fragment">python plot_tutoSheetFlow.py
</pre><p>and you should see the following figures:</p>
<div class="image">
<img src="res1_tuto3.png" alt="res1_tuto3.png"/>
<div class="caption">
Figure 6: Comparison of two-phase numerical results with experiments of Revil-Baudard et al. (2015) in terms of velocity profiles (left panel), volume fraction (center panel) and Reynolds shear stress (right panel) using the dense granular flow rheology mu(I) with the Mixing Length (ML) turbulence model. </div></div>
 <h1><a class="anchor" id="dryavalanche"></a>
Dry granular avalanche: 1DAvalancheMuI</h1>
<p>We consider a fluid-solid mixture avalanche flowing under a steady-state moving down a planar slope as illustrated in figure 7. In this example, dense granular flow is reproduced by means of the dense granular flow rheology <img class="formulaInl" alt="$\mu(I)$" src="form_9.png"/>. Numerical results are contrasted with the analytical solution (Bagnold's solution).</p>
<div class="image">
<img src="scheme1Davalanche.png" alt="scheme1Davalanche.png"/>
<div class="caption">
Figure 7: Schematic section of the dry avalanche flowing down on a uniform slope. The coordinate system and main lengths are defined.</div></div>
 <h2><a class="anchor" id="preprocAva"></a>
Pre-processing</h2>
<p>This tutorial is distributed with sedFoam5.0 under the folder <em>sedFoamDirectory/tutorials/1DAvalancheMuI</em>.</p>
<h3><a class="anchor" id="meshgenAva"></a>
Mesh generation</h3>
<p>Because the avalanche is assumed to be in a stationary state, the simulation can be easily reduced to a one-dimensional problem. The numerical domain consists of a square of side length L = 0.00025 m in the x-y plane and of height h=0.025 m in the vertical direction z. A uniform mesh of 1 by 1 by 100 cells will be used (see <img class="formulaInl" alt="$ n_{x}$" src="form_13.png"/>=1 and <img class="formulaInl" alt="$ n_{z}$" src="form_14.png"/>=100 in figure 7). The block structure is the same as for the Sedimentation test case and is shown in figure 1.</p>
<p>The mesh is generated by running blockMesh from within the case directory:</p>
<pre class="fragment">blockMesh
</pre><h3><a class="anchor" id="BC_initiAva"></a>
Boundary and initial conditions</h3>
<p>The case is set up to start at time t = 0 s, again the initial field data are stored in a 0_org sub-directory of the case directory. The 0_org sub-directory contains several files: alpha_a, Ua, Ub, p_rbgh, muI, pa, Theta, one for each of the solid phase volume fraction (alpha_a), velocities of solid and fluid phases (Ua and Ub), the reduced pressure (p_rbgh) fields whose initial values and boundary conditions must be set. No-slip boundary conditions are imposed for both phases at the top and bottom boundaries (zero velocity at the solid boundaries). Additionally, cyclic boundaries are considered in the inlet and outlet (upstream and downstream boundaries in figure 7.). Cyclic boundaries are imposed to connect two equal meshes. The frontAndBack patch represents the front and back planes of the 2D case and therefore must be set as empty.</p>
<h3><a class="anchor" id="PhysPropAva"></a>
Physical properties</h3>
<p>The following variables are considered:</p>
<a class="anchor" id="multi_row"></a>
<table class="doxtable">
<caption>Main physical parameters.</caption>
<tr>
<th>Properties </th><th>Value </th></tr>
<tr>
<td>Solid density </td><td><img class="formulaInl" alt="$\rho_p=2650 \frac{kg}{m^3}$" src="form_15.png"/> </td></tr>
<tr>
<td>Fluid density </td><td><img class="formulaInl" alt="$\rho_f=1 \frac{kg}{m^3}$" src="form_16.png"/> </td></tr>
<tr>
<td>Fluid viscosity </td><td><img class="formulaInl" alt="$\nu^f=1 \cdot 10^{-3} \frac{m^2}{s}$" src="form_17.png"/> </td></tr>
<tr>
<td>Mean particle diameter </td><td><img class="formulaInl" alt="$d=500 \cdot 10^{-6} m$" src="form_18.png"/> </td></tr>
<tr>
<td>Slope inclined at the angle </td><td><img class="formulaInl" alt="$\theta=26^o $" src="form_19.png"/> </td></tr>
<tr>
<td>Solid phase thickness </td><td><img class="formulaInl" alt="$h=0.0125 m$" src="form_20.png"/> </td></tr>
<tr>
<td>Initial solid volume fraction </td><td><img class="formulaInl" alt="$\phi=0.6$" src="form_21.png"/> </td></tr>
</table>
<p>The <em>transportProperties</em> file for the 1DAvalancheMuI case is shown below:</p>
<pre class="fragment">phasea
{
    rho             rho [ 1 -3 0 0 0 ] 2650;
    nu              nu [ 0 2 -1 0 0 ] 1e-6;
    d               d [ 0 1 0 0 0 0 0 ] 500.e-6;
}

phaseb
{
    rho             rho [ 1 -3 0 0 0 ] 1.;
    nu              nu [ 0 2 -1 0 0 ] 1e-3;
    d               d [ 0 1 0 0 0 0 0 ] 2.e-3;
}
//*********************************************************************** //
transportModel  Newtonian;

nu              nu [ 0 2 -1 0 0 0 0 ] 1e-3;

// Diffusivity for mass conservation resolution (avoid num instab around shocks)
alphaDiffusion  alphaDiffusion [0 2 -1 0 0 0 0] 1e-8;

nuMax           nuMax [0 2 -1 0 0 0 0] 1e0;      // viscosity limiter for the Frictional model (required for stability)

alphaSmall      alphaSmall [ 0 0 0 0 0 0 0 ] 1e-6;  // minimum volume fraction (phase a) for division by alpha </pre><p>Dense granular flow rheology <img class="formulaInl" alt="$\mu(I)$" src="form_9.png"/> is used as shown in <em>granularRheologyProperties</em>:</p>
<pre class="fragment">granularRheology   on;

alphaMaxG       alphaMaxG [ 0 0 0 0 0 0 0 ] 0.6;

mus             mus  [ 0 0 0 0 0 0 0 ] 0.38;

mu2             mu2  [ 0 0 0 0 0 0 0 ] 0.64;

I0              I0  [ 0 0 0 0 0 0 0 ] 0.3;

Bphi            Bphi [ 0 0 0 0 0 0 0 ] 0.31;

n               n [ 0 0 0 0 0 0 0 ] 2.5;

Dsmall          Dsmall [ 0 0 -1 0 0 0 0 ] 1e-6;

BulkFactor      BulkFactor [ 0 0 0 0 0 0 0 ] 1e0;

relaxPa         relaxPa [ 0 0 0 0 0 0 0 ] 1;

FrictionModel   MuI;

PPressureModel  MuI;

FluidViscosityModel  none;</pre><p>Additionally, <em>FluidViscosityModel</em> model is set to <em>none</em>. Even though no <em>FluidViscosityModel</em> is specified, the shear induced contribution associated to the fluid phase is still present. However, it has insignificant influence on the results due to the low fluid viscosity. On the contrary, the analytical solution assumes that shear induced contribution to the fluid phase is null.</p>
<p>Finally, the file <em>constant/g</em> is modified to take into account the <img class="formulaInl" alt="$y$" src="form_22.png"/>-axis component of gravity. In this work the plane is inclined to <img class="formulaInl" alt="$\theta=26^o $" src="form_19.png"/>, however, other angles may be considered.</p>
<pre class="fragment">dimensions      [0 1 -2 0 0 0 0];

// tilt angfle = 26°
value           ( 0 -8.817169594194828 0);</pre><h2><a class="anchor" id="postSF2"></a>
Post-processing using python</h2>
<p>The user can execute post-processing functions after the simulation is complete using the <em>postProcess</em> utility. Simple functions can be executed using the *-func* option. For instance, we can compute the shear rate of the solid phase as:</p>
<pre class="fragment">postProcess -func 'grad(Ua)'
</pre><p>Finally, the analytical and SedFoam results are obtained running the python script <em>plot_tutoAvalanche.py</em> located in the folder <em>tutorials/Py</em>:</p>
<pre class="fragment">python plot_tutoAvalanche.py
</pre><p>and you should see the following figure:</p>
<div class="image">
<img src="res1_tuto_avalanche.png" alt="res1_tuto_avalanche.png"/>
<div class="caption">
Figure 8: Evolution of a) solid volume fraction, b) velocity, c) solid phase pressure, d) mu(I), e) shear stress f) frictional viscosity, and g) shear rate in function of height (y). Results are expressed in dimensionless terms.</div></div>
 <h1><a class="anchor" id="Scour"></a>
Scour downstream of an apron: 2DScourApron</h1>
<p>In this 2D configuration, we are looking at the scour development downstream of an apron. Following the numerical study of Amoudry &amp; Liu (2009) and Cheng et al. (2017), the scour problem is simplified and sketched in figure 9.</p>
<h2><a class="anchor" id="preprocSA"></a>
Pre-processing</h2>
<p>This tutorial is distributed with sedFoam3.0 under the folder sedFoamDirectory/tutorials/2DScourApron.</p>
<h3><a class="anchor" id="meshgenSA"></a>
Mesh generation</h3>
<p>The numerical domain consists of a rectangle of side length L = 0.5 m in the x-y plane and of height h=0.25 m in the vertical direction z, where the flow depth is chosen to be <img class="formulaInl" alt="$h_0$" src="form_23.png"/> = 0.15m, and the initial bed depth is <img class="formulaInl" alt="$h_b$" src="form_24.png"/> = 0.05m. A regular grid is used in the vertical direction for the sediment bed (50 elements along the vertical direction) and in horizontal direction (250 elements). Inside the water column, 100 grid points are used with an increasing cell ratio of 2 along the vertical direction. Please note that this coarse mesh is for tutorial purpose only. If you want a finer mesh you may refer to Chauchat et al. (2017). The block structure is shown in Figure 9.</p>
<div class="image">
<img src="sketch_apron_charlie.png" alt="sketch_apron_charlie.png"/>
<div class="caption">
Figure 9: Sketch of the scour downstream an apron.</div></div>
  The mesh is generated by running blockMesh from within the case directory:</p>
<pre class="fragment">blockMesh
</pre><h3><a class="anchor" id="BC_initiSA"></a>
Boundary and initial conditions</h3>
<p>The case is set up to start at time t = 0 s, as for the previous 1D tutorials the initial fields data are stored in the 0_org sub-directory of the case directory.</p>
<p>The bottom boundary, the lower part of the inlet (forming the step) and of the outlet are set as wall boundaries. The upper part of the inlet is an inlet boundary where the velocity profile is imposed according to the rough wall log law (eq. (73) in Chauchat et al. (2017)) via the GroovyBC utility. Turbulent quantities are imposed as constant values following recommendation from esi group (<a href="http://www.esi-cfd.com/content/view/877/192/">http://www.esi-cfd.com/content/view/877/192/</a>). At the outlet, a directionMixed boundary condition is used for the velocities of both phases (zeroGradient for streamwise component and zero value for the vertical one) and the hydrostatic pressure is imposed thanks to the GroovyBC utility. As initial condition, the velocity of both phases, the sediment concentration, the TKE and the TKE dissipation are set based on one-dimensional simulation results using funkySetFields. The details of the boundary conditions are summarized in the following table:</p>
<a class="anchor" id="multi_row"></a>
<table class="doxtable">
<caption>Summary of the boundary conditions implemented in the 2D scour downstream of an apron configuration: zG = zeroGradient, fV = fixedValue, dM = directionMixed, fFP = fixedFluxPressure and hp=hydrostatic pressure.</caption>
<tr>
<th>Boundary </th><th>type </th><th><img class="formulaInl" alt="$\alpha$" src="form_25.png"/> </th><th>k </th><th><img class="formulaInl" alt="$\varepsilon$" src="form_10.png"/> or <img class="formulaInl" alt="$\omega$" src="form_11.png"/> </th><th><img class="formulaInl" alt="$u^k$" src="form_26.png"/> </th><th>p </th><th><img class="formulaInl" alt="$\theta$" src="form_8.png"/> (for KT) </th></tr>
<tr>
<td>top </td><td>patch </td><td>zG </td><td>zG </td><td>zG </td><td>zG </td><td>zG </td><td>zG </td></tr>
<tr>
<td>bottom </td><td>wall </td><td>zG </td><td>zG </td><td>zG </td><td>fV, <img class="formulaInl" alt="$u^k=0$" src="form_27.png"/> </td><td>fFP </td><td>zG </td></tr>
<tr>
<td>inlet (flow) </td><td>patch </td><td>1dprof </td><td>fV, k=1 <img class="formulaInl" alt="$\times 10^{-4}$" src="form_28.png"/> </td><td>zG </td><td>Gbc </td><td>zG </td><td>fV, k=1 <img class="formulaInl" alt="$\times 10^{-6}$" src="form_29.png"/> </td></tr>
<tr>
<td>inlet (sed) </td><td>wall </td><td>zG </td><td>fV, k=1 <img class="formulaInl" alt="$\time 10^{-12}$" src="form_30.png"/></td><td>zG </td><td>fV, <img class="formulaInl" alt="$u^k=0$" src="form_27.png"/> </td><td>zG </td><td>zG </td></tr>
<tr>
<td>outlet (flow) </td><td>patch </td><td>zG </td><td>zG </td><td>zG </td><td>dM </td><td>hp </td><td>zG </td></tr>
<tr>
<td>outlet (sed) </td><td>wall </td><td>zG </td><td>fV, k=1 <img class="formulaInl" alt="$\time 10^{-12}$" src="form_30.png"/></td><td>zG </td><td>fV, <img class="formulaInl" alt="$u^k=0$" src="form_27.png"/> </td><td>hp </td><td>zG </td></tr>
</table>
<h3><a class="anchor" id="PhysPropSA"></a>
Physical properties</h3>
<p>The transportProperties file for the 2DScourApron case is shown below:</p>
<pre class="fragment">phasea
{
    rho             rho [ 1 -3 0 0 0 ] 2650;
    nu              nu [ 0 2 -1 0 0 ] 1e-6;
    d               d [ 0 1 0 0 0 0 0 ] 0.25e-3;
    sF              sF   [ 0 0  0 0 0 0 0 ] 1.;    // shape Factor to adjust settling velocity for non-spherical particles
    hExp            hExp [ 0 0  0 0 0 0 0 ] 2.65;  // hindrance exponent for drag: beta^(-hExp) (2.65 by default)
}

phaseb
{
    rho             rho [ 1 -3 0 0 0 ] 1000;
    nu              nu [ 0 2 -1 0 0 ] 1.e-06;
    d               d [ 0 1 0 0 0 0 0 ] 10e-6;
    sF              sF   [ 0 0  0 0 0 0 0 ] 1.;
    hExp            hExp [ 0 0  0 0 0 0 0 ] 2.65;
}
//*********************************************************************** //

alphaSmall      alphaSmall [ 0 0 0 0 0 0 0 ] 1e-6;  // minimum volume fraction (phase a) for division by alpha 

alphaAlpha      alphaAlpha [ 0 0 0 0 0 ] 0;         // surface tension

Cvm             Cvm [ 0 0 0 0 0 ] 0;                // Virtual/Added Mass coefficient

Cl              Cl [ 0 0 0 0 0 ] 0;                 // Lift force coefficient

Ct              Ct [ 0 0 0 0 0 ] 0;                 // Eddy diffusivity coefficient for phase a


transportModel  Newtonian;

nu              nu [ 0 2 -1 0 0 0 0 ] 1e-06;

nuMax        nuMax [0 2 -1 0 0 0 0] 0.1;      // viscosity limiter for the Frictional model (required for stability)
</pre><p>The physical property of the particles (diameter and density) and of the fluid (density and kinematic viscosity) have been set to the values given in Amoudry &amp; Liu (2009).</p>
<p>For this case, the dense granular flow rheology <img class="formulaInl" alt="$\mu(I)$" src="form_9.png"/> is used and the parameters are set according to Chauchat (2017). Furthermore a shear induced pressure (PPressureModel) and an effective fluid viscosity model (FluidViscosityModel) from Boyer et al. (2011) are used:</p>
<pre class="fragment">granularRheology   on;

alphaMaxG       alphaMaxG [ 0 0 0 0 0 0 0 ] 0.625;

mus             mus  [ 0 0 0 0 0 0 0 ] 0.4;

mu2             mu2  [ 0 0 0 0 0 0 0 ] 0.9;

I0              I0  [ 0 0 0 0 0 0 0 ] 0.6;

Bphi            Bphi [ 0 0 0 0 0 0 0 ] 0.66;

n               n [ 0 0 0 0 0 0 0 ] 2.5;

Dsmall          Dsmall [ 0 0 -1 0 0 0 0 ] 1e-4;

relaxPa         relaxPa [ 0 0 0 0 0 0 0 ] 1;

zbed         zbed [ 0 1 0 0 0 0 0 ] 0.0;

FrictionModel  MuI;

PPressureModel MuI;

FluidViscosityModel  BoyerEtAl;
</pre><h3><a class="anchor" id="Disc_solvSF2"></a>
Discretisation and linear-solver settings</h3>
<p>The numerical schemes and the solvers are the same as in the 1DSheetFlow case.</p>
<h3><a class="anchor" id="control_sedFoamSF2"></a>
Control</h3>
<p>The system/controlDict file indicates that for this case the time step is equal to <img class="formulaInl" alt="$ 2.10^{-5}$" src="form_12.png"/> s and that the computation ends at 60s of dynamics. The output write interval has been set to 5s by default. The user is invited to reduce it in order to capture the evolution of the scour hole more accurately. Additionally, time step can be increased to <img class="formulaInl" alt="$ 2.10^{-4}$" src="form_31.png"/> s after 2s to speed up the computational time.</p>
<pre class="fragment">application     sedFoam;

startFrom       latestTime;

startTime       0;

stopAt          endTime;

endTime         60;

deltaT          2e-5;

writeControl    adjustableRunTime;

writeInterval   0.5;

purgeWrite      0;

writeFormat     binary;

writePrecision  6;

writeCompression uncompressed;

timeFormat      general;

timePrecision   6;

runTimeModifiable on;

adjustTimeStep  true;

maxCo           0.05;

maxAlphaCo      0.05;

maxDeltaT       2e-5;

libs (
"libgroovyBC.so"
"libgroovyStandardBCs.so"
     );
</pre><h3><a class="anchor" id="lauch_SA"></a>
Computation launching</h3>
<p>As for the previous cases, you can lauch the computation by executing * Allrun *. This shell script contains two lines specific to the present multidimensionnal case:</p>
<pre class="fragment"># Decompose the case in order to run in parallel (on 4 cores)
decomposePar

# Run sedFoam_rbgh in parallel
mpirun -np 4 sedFoam_rbgh -parallel &gt; log&amp;
</pre><p> First of all, as the mesh is composed of 37500 cells, computation runs faster on several processors (the best compromise is around 10000 cells per core). Here, the <em>decomposePar</em> command decompose the initial time (specified in the <em>controlDict</em> file) in the number of part specified in the <em>system/decomposeParDict</em> file.</p>
<p>The second command specify that the computation is launched in parallel with <em>mpirun</em>.</p>
<h2><a class="anchor" id="postSF2"></a>
Post-processing using python</h2>
<p>You just have to run the python script <em>plot_tuto2DScour.py</em> located in the folder <em>tutorials/Py</em>:</p>
<pre class="fragment">python plot_tuto2DScour.py
</pre><p>and you should see the following figures:</p>
<div class="image">
<img src="res1_tuto4.png" alt="res1_tuto4.png"/>
<div class="caption">
Figure 10: Sediment interface position at different times during the scour process using a k-omega turbulence model and the mu(I) granular rheology.</div></div>
 <div class="image">
<img src="res2_tuto4.png" alt="res2_tuto4.png"/>
<div class="caption">
Figure 11: Sediment concentration contour at different times during the scour process using a k-omega turbulence model and the mu(I) granular rheology. </div></div>
 <h1><a class="anchor" id="appendix"></a>
Variables list</h1>
<ul>
<li>
alpha_a: Sediment phase volume fraction field. </li>
<li>
Ua: Sediment phase velocity field. </li>
<li>
Ub: Fluid phase velocity field. </li>
<li>
p_rbgh: Fluid reduced pressure field (equal to p-rhob*g*h). </li>
<li>
pa: Sediment phase pressure (collisional/shear induced) field. </li>
<li>
Theta: Granular temperature (for kinetic theory model only). </li>
<li>
k: Fluid turbulent kinetic energy. </li>
<li>
epsilon: Fluid turbulent dissipation rate. </li>
<li>
omega: Fluid specific turbulent dissipation rate. </li>
<li>
nut: Turbulent viscosity. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Oct 20 2020 12:15:28 for SedFOAM by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
    <li> Copyright&#x00A0;&#169;&#x00A0;2016&#x00A0;Cyrille Bonamy, Julien Chauchat, Tim Nagel, Antoine Mathieu, Zhen Cheng, Eduard Puig Montella  and Tian-Jian Hsu 
  </ul>
</div>
</body>
</html>
